/*
 * This file is part of the ProVANT simulator project.
 * Licensed under the terms of the MIT open source license. More details at
 * https://github.com/Guiraffo/ProVANT-Simulator/blob/master/LICENSE.md
 */
/**
 * @file This file contains the implementation of the Vant5RamcVaryinglyapunov class.
 *
 * @author Jonatan Mota Campos
 */

#include <control_strategies_base/icontroller.hpp>
#include <vector>
#include <Eigen/Eigen>
#include <iostream>
#include "simulator_msgs/Sensor.h"
#include <cmath>
#include <ros/ros.h>

class Vant5RamcVaryinglyapunov : public Icontroller
{
private: Eigen::VectorXd X;
private: Eigen::VectorXd XFull;
private: Eigen::VectorXd Xref;
private: Eigen::VectorXd XrefFull;
private: Eigen::VectorXd Uref;
private: Eigen::VectorXd Erro;
private: Eigen::MatrixXd Xu;
private: Eigen::MatrixXd Yu;
private: Eigen::MatrixXd Xc1;
private: Eigen::MatrixXd Yc1;
private: Eigen::MatrixXd Xc2;
private: Eigen::MatrixXd Yc2;
private: Eigen::MatrixXd Xc3;
private: Eigen::MatrixXd Yc3;
private: Eigen::MatrixXd Xc4;
private: Eigen::MatrixXd Yc4;
private: Eigen::MatrixXd Xc5;
private: Eigen::MatrixXd Yc5;
private: Eigen::MatrixXd Xc6;
private: Eigen::MatrixXd Yc6;
private: Eigen::MatrixXd Xc7;
private: Eigen::MatrixXd Yc7;
private: Eigen::MatrixXd K;
private: Eigen::VectorXd Input2;
private: Eigen::VectorXd Input;
private: Eigen::VectorXd Trajetoria;
private: Eigen::MatrixXd AdaptiveMixingSets;
private: Eigen::VectorXd AdaptiveMixingSetsCutoff;
private: Eigen::VectorXd AdaptiveMixingSetsMean;
private: Eigen::VectorXd intqctil;
private: double pi;
private: double T;
private: double NSets;
public:
	Vant5RamcVaryinglyapunov(): Yu(11,22), Yc1(11,22), Yc2(11,22), Yc3(11,22),Yc4(11,22),Yc5(11,22),Yc6(11,22),Yc7(11,22),
								Xu(22,22), Xc1(22,22),Xc2(22,22),Xc3(22,22),Xc4(22,22),Xc5(22,22),Xc6(22,22),Xc7(22,22),
								K(11,22),  X(22),Xref(22),Uref(11),Erro(22),Input2(11),Input(14),Trajetoria(31),
				    			AdaptiveMixingSets(7,2),AdaptiveMixingSetsCutoff(7),AdaptiveMixingSetsMean(7),
				    			intqctil(4), XFull(24), XrefFull(24)							
	{
	AdaptiveMixingSets << 0, 16,
						 12, 22,
						 18, 28,
						 24, 34,
						 30, 40,
						 36, 44,
						 40, 48;
	AdaptiveMixingSetsCutoff << (AdaptiveMixingSets.col(1) - AdaptiveMixingSets.col(0))/2.0;
	AdaptiveMixingSetsMean << AdaptiveMixingSets.col(1) - AdaptiveMixingSetsCutoff;
	NSets = 7;
	T = 0.004;
	pi = 3.141592653589793;


Xc1 << 500.13,-0.095858,15.001,-0.46359,31.178,27.195,-18.469,-17.134,-83.887,0.22012,-47.211,0.25906,-11.342,0.014812,-35.465,-29.114,4.3334,2.6689,-183.11,-0.38489,-128.54,-2.9868,
-0.065172,3.0979,-0.0059934,0.82245,-0.57375,0.66131,0.17712,-0.21226,-0.086337,4.4257,-0.012706,-0.23612,0.063462,-0.23301,0.12028,0.018853,0.16979,-0.068861,0.027182,0.80261,0.067091,7.8067,
14.754,-0.0039853,1.4693,-0.0086717,1.9905,2.0045,-0.9255,-0.93553,-5.1304,-0.010019,0.77544,-0.010083,-0.62659,-0.011541,-1.449,-1.2445,1.7611,1.7212,4.7923,-0.0089184,-6.4393,-0.032976,
-0.47371,0.68194,-0.012587,2.6181,-0.3514,0.33057,-0.13758,0.14936,0.007542,-0.67635,0.07283,0.7446,0.031142,0.13748,0.22955,-0.013722,0.67132,-0.65909,0.57555,-2.1362,0.042178,2.306,
29.825,-0.55063,1.5521,-0.34272,24.596,23.51,-6.6474,-6.8879,-37.371,-0.85592,21.202,-0.43451,0.69202,-0.72146,-1.1731,-0.5661,7.0546,8.1849,30.876,0.12624,-36.624,-3.101,
26.879,0.61053,1.5926,0.37291,23.589,25.858,-6.9548,-7.1194,-35.955,0.85361,17.141,0.4818,0.74,0.55347,-0.91825,-0.81189,8.6708,7.7175,58.094,-0.0048164,-41.695,3.1639,
-18.492,0.19312,-0.54857,-0.12082,-5.692,-5.9173,6.7818,5.1498,14.708,0.74094,-15.719,-0.046177,-6.3462,-1.8853,-10.873,-10.224,-3.0014,0.3884,-14.106,0.38569,8.9009,0.52697,
-17.515,-0.24227,-0.56003,0.14001,-5.967,-6.1142,5.1819,6.9528,14.154,-0.94335,-14.409,0.086387,-6.3753,1.9187,-10.022,-11.055,0.43491,-2.8035,-22.982,-0.41086,10.617,-0.48403,
-62.931,-0.093191,-1.8219,-0.05469,-29.161,-27.592,16.07,15.613,148.51,0.35328,-125.16,0.073689,-16.784,0.19953,-48.841,-49.712,-13.044,-13.684,134.88,-0.02088,-44.651,0.34217,
0.13467,0.63591,0.015284,-1.8648,0.17979,-0.061279,1.3502,-1.4631,0.048488,84.539,-0.60188,25.866,0.024459,5.1502,-6.2358,6.5296,1.1445,0.13839,2.4619,0.33712,-0.46825,-7.4304,
-107.28,0.067841,-2.7633,0.1348,17.404,13.893,-17.756,-16.65,-119.84,-0.73254,320.81,-0.29285,23.803,-0.2049,57.093,54.798,-14.381,-13.884,-308.35,0.30232,113.74,0.37733,
0.1587,-1.71,-0.003244,0.22125,0.011787,0.005621,0.081673,-0.010125,-0.17705,23.854,-0.21059,13.658,-0.0065171,2.3097,-1.2567,1.5741,5.3505,-3.3733,-0.11256,-1.3365,0.055907,-3.3922,
-5.0101,0.01343,-2.495,0.0037267,-1.4089,-1.4876,-2.0635,-2.0609,-8.0142,-0.05778,1.5923,0.04608,21.623,-0.019935,23.759,23.649,-21.787,-21.707,-8.9906,0.00065472,12.291,0.0050303,
0.0028183,-0.82083,0.001393,-0.90995,-0.049726,0.061499,-0.4297,0.38027,-0.062245,10.003,-0.17759,2.8432,-0.015707,8.8837,-4.1123,4.1767,-8.9098,11.119,0.34038,-1.6693,-0.045249,0.46105,
-32.352,0.206,-3.674,0.65661,-8.6683,-7.7355,-8.579,-6.0799,-29.241,-8.9776,27.936,-1.7768,32.991,-3.353,79.81,60.193,13.961,-40.344,-19.314,-0.41308,47.311,1.3089,
-25.953,-0.1248,-3.467,-0.5919,-7.3032,-8.4274,-6.3634,-8.6842,-30.215,9.5562,26.518,2.0483,32.742,3.5535,60.272,78.4,-39.459,13.273,-20.286,0.33804,45.438,-1.3918,
-0.6996,-0.65298,3.3793,1.7833,7.2755,10.158,-12.689,-5.0412,-30.535,-9.2731,8.3862,2.988,-19.005,-8.5511,26.861,-25.215,208.85,36.789,38.958,-2.0853,-2.8431,-0.027486,
-2.7463,0.62279,3.3079,-1.8081,9.8073,7.7953,-4.9948,-12.854,-30.075,9.3641,8.7901,-2.9534,-18.881,8.5148,-25.531,26.728,36.991,206.05,39.246,2.0344,-2.4167,-0.067331,
-99.772,0.059925,7.253,0.504,38.171,65.068,-20.24,-29.078,122.19,2.2834,-333.71,-0.22559,-1.8907,0.26668,-15.319,-15.296,34.634,34.301,2052.9,-0.028612,-451.63,6.8321,
-0.40961,1.1531,-0.011378,-1.6458,0.05802,0.13321,0.38091,-0.39799,-0.12828,-0.73988,0.2593,-1.6452,0.0094038,-2.3885,-0.14141,-0.02473,-1.3367,1.4563,0.033007,13.745,0.17234,0.80065,
-148.18,0.10264,-7.9142,0.064327,-43.256,-47.939,10.605,12.088,-20.333,-0.43997,91.169,0.030178,15.081,-0.055749,47.727,45.753,-13.153,-12.207,-422.58,0.17695,238.48,-0.29681,
-2.9624,7.9914,-0.051187,2.2311,-3.0675,3.3046,0.65202,-0.69801,0.27277,3.6237,0.012721,0.14455,0.083722,1.3572,0.34399,-0.16725,-0.10898,1.1128,7.3685,0.28828,-0.5599,48.178;

Xc2 << 387.05,1.0747,21.86,-0.21603,-9.2195,-10.007,-16.341,-16.067,-40.899,-0.20558,228.37,0.36692,8.6404,-0.72753,-16.366,-15.016,-2.625,-3.3486,-78.377,0.5822,-32.449,-1.3439,
1.1181,3.6024,0.048051,0.54413,-0.19543,0.17094,0.016256,-0.097429,-0.048894,0.86706,0.17605,-0.61325,-0.090285,-0.75586,-0.0055302,-0.1388,0.43376,-0.35331,-0.81702,2.7159,0.03646,3.7614,
24.958,0.053162,2.9384,-0.016383,-0.59075,-0.58016,-1.4686,-1.4766,-4.0421,0.044377,28.684,0.043072,-1.3569,-0.039271,-0.8161,-0.73135,0.92202,0.8878,6.1096,0.025194,-3.2768,-0.030367,
-0.37473,0.39106,-0.016183,2.0064,-0.04848,0.10966,-0.17516,0.26695,-0.074568,-4.1574,0.56597,0.78983,-0.011939,0.043755,0.19441,-0.25841,0.39265,-0.40895,-0.53719,-0.64713,0.10393,0.87195,
-11.203,-0.24132,-0.73871,-0.047205,2.1776,1.0455,0.69771,0.56298,-1.6845,0.80701,4.8888,0.098771,1.2396,-0.44324,-0.16908,-0.0246,-1.1013,-0.48435,-12.098,-0.047126,1.9531,-1.167,
-11.742,0.18881,-0.70562,0.10884,1.041,2.1539,0.51818,0.68931,-1.5517,-0.81048,4.0916,0.092616,1.1089,0.50518,0.12376,-0.22725,-0.20915,-1.001,-7.9839,0.10463,1.6528,1.2177,
-16.196,9.3503e-05,-1.2736,-0.18777,0.66179,0.46804,2.4339,0.93846,1.5566,2.8373,-16.041,0.30831,-0.55283,-1.1996,0.28981,0.93973,-2.3528,-0.1938,-7.6585,0.11194,1.7307,-0.26302,
-15.996,-0.10676,-1.2821,0.27036,0.49558,0.6564,0.94536,2.475,1.4525,-3.1165,-15.61,-0.17236,-0.50621,1.2625,0.98297,0.18156,-0.082231,-2.1649,-9.1427,-0.22834,1.8682,0.37771,
-27.773,-0.030813,-1.8069,-0.080151,-1.9647,-1.8057,1.5182,1.4055,26.63,0.11203,-112.05,-0.45129,-14.002,-0.05513,0.5025,0.46458,0.9137,1.1274,57.11,-0.069382,-7.7499,-0.036831,
-0.12827,-1.2769,0.015794,-4.6288,1.3279,-1.362,3.503,-3.7397,0.12884,105.21,-0.53164,20.893,-0.34523,1.4562,-4.7757,5.2287,-2.5941,4.231,1.4758,2.0288,-0.039808,-9.2517,
143.92,-0.0016707,17.63,0.45997,9.4061,8.4581,-11.901,-11.441,-122.55,-0.17594,841.78,1.764,55.416,0.065731,-8.8753,-8.7157,-19.903,-19.743,-278.38,0.30765,18.655,0.20605,
-0.20961,-1.4036,0.030414,0.60585,0.24455,-0.029889,0.42033,-0.31488,-0.45718,20.632,2.5772,11.418,-0.27547,0.87697,0.28561,-0.31272,5.2771,-2.6401,-1.294,-0.76968,0.30654,-0.50993,
-0.62023,-0.022834,-4.792,0.0091833,0.65449,0.56744,0.87812,0.9255,-5.6507,0.18457,-12.768,-0.0017962,44.424,0.1004,-0.84841,-0.75628,-16.208,-16.427,-24.53,0.043712,6.7226,0.022618,
-0.76391,-0.9638,-0.039453,-0.60243,-0.086601,0.10307,0.045105,-0.029238,0.039907,13.068,-0.24758,2.9541,-0.027871,7.6019,-4.1946,4.3296,-10.846,12.397,0.50189,-1.7954,0.017366,3.2593,
-15.138,-0.20838,-0.59569,0.48642,-0.83224,0.029687,-0.6329,1.6304,0.9871,-11.78,-11.022,-1.0526,-1.3762,-3.9012,11.85,-5.8418,30.48,-21.287,15.234,-0.11976,0.28607,-0.26461,
-13.677,0.14052,-0.53733,-0.5627,-0.085422,-0.83672,1.5535,-0.79526,0.91676,12.092,-11.082,0.7113,-1.2364,3.9344,-5.874,11.927,-21.216,30.921,15.569,0.11363,0.1495,0.18436,
2.4589,-0.80976,2.1186,1.1967,-2.2656,-0.14493,-5.9286,0.94029,-1.4851,-24.446,2.1432,0.53877,-17.257,-11.7,30.464,-21.061,146.9,-18.683,16.728,-0.18134,-3.4035,-2.1255,
1.4848,0.68513,2.0636,-1.3219,-0.19694,-2.1759,0.82587,-5.9669,-1.3094,24.395,2.0067,-0.41965,-17.315,11.827,-20.923,30.634,-18.344,144.77,17.024,0.16289,-3.4248,2.0281,
-6.2908,-0.6095,11.539,-0.5937,-14.016,-9.9951,-10.753,-12.217,50.218,1.2233,-229.27,-1.3371,-28.803,0.29788,12.566,13.085,18.549,18.536,874.54,-1.1419,-87.646,1.7102,
0.51987,2.8518,0.0047623,-0.26879,-0.059234,0.13019,0.084858,-0.16337,-0.048947,0.84644,0.16799,-0.72139,0.013615,-1.7886,-0.14418,0.14024,-0.35814,0.46817,-1.2045,8.3973,0.17524,-0.97523,
-41.316,-0.0228,-3.9404,0.091698,1.9281,1.6519,2.1716,2.2703,-3.8388,-0.12503,-1.4244,0.26169,6.5996,0.023583,0.60433,0.4259,-2.6056,-2.6456,-79.314,0.13124,22.218,0.0062455,
-1.3752,3.583,-0.044623,0.2978,-1.0497,1.1133,0.076162,0.04537,0.077275,1.7296,-0.31362,1.7321,-0.13231,3.5981,-0.47037,0.46237,-1.0644,1.9682,1.9882,-1.0051,0.0024485,25.861;

Xc3 << 430.5,1.2435,22.537,-0.044903,-8.2166,-7.8699,-12.906,-12.972,-38.884,-0.75683,427.89,0.5302,25.568,-0.58972,-33.151,-34.65,-11.514,-11.194,-81.739,0.43415,-31.265,-0.95156,
1.2821,3.945,0.05876,0.42524,-0.0327,0.06179,-0.0676,-0.041998,-0.01156,0.49387,0.58573,-0.54052,-0.089303,-0.77571,0.066426,-0.21204,0.67941,-0.40671,-0.65188,3.3854,-0.073256,3.2654,
28.374,0.070361,2.9858,-0.010856,-1.2137,-1.2414,-0.92864,-0.91824,-2.7354,-0.0043243,36.946,0.045226,-1.1253,-0.029304,-1.7906,-1.8826,0.50075,0.57809,9.3952,0.015292,-3.0049,-0.019863,
-0.16689,0.3069,-0.010409,1.7332,-0.012351,0.10138,-0.14658,0.2234,-0.077956,-4.1006,0.4146,0.76082,-0.021881,0.014441,0.31159,-0.36293,0.33937,-0.36013,-0.44653,-0.49961,0.031969,0.5167,
-13.18,-0.094698,-1.4448,0.012496,3.8999,2.8482,1.0497,0.90165,-3.4989,0.90395,2.7635,0.17258,2.0597,-0.48719,-0.50677,-0.14533,-1.6009,-0.75949,-35.877,0.19216,3.6983,-1.4992,
-13.107,0.064539,-1.4909,0.07199,2.8504,4.1529,0.9464,1.0466,-3.6571,-1.016,3.3783,0.25966,2.1407,0.53133,-0.17941,-0.51606,-0.55886,-1.655,-38.467,-0.076198,3.8588,1.5092,
-13.887,-0.060561,-0.92774,-0.15349,0.98721,0.86224,2.2647,0.83886,-1.0465,3.0736,-7.3499,0.27655,1.057,-0.94441,0.02817,0.70937,-3.8336,-1.5601,-4.5887,-0.014021,0.81733,-0.096372,
-13.87,-0.069604,-0.90796,0.21917,0.8146,0.96775,0.8365,2.2782,-1.0495,-3.3253,-7.3631,-0.090508,0.99482,1.0226,0.69853,0.12183,-1.4012,-3.5983,-3.8276,-0.11039,0.78758,0.24242,
-26.019,0.025431,-0.59398,-0.073808,-4.1415,-4.3289,-1.0849,-1.0695,23.757,0.11727,-112.25,-0.72698,-15.46,-0.083045,3.7781,3.9015,0.6387,0.72941,50.959,-0.0044708,-6.1447,-0.11421,
-0.56587,-1.598,0.0065634,-4.415,1.6728,-1.8453,3.8617,-4.2065,0.22416,124.88,-0.17794,19.547,-0.42268,0.70148,-6.825,7.8723,-3.6155,7.2841,1.2136,1.9986,0.048967,-10.666,
350.4,0.36259,23.222,0.2781,11.723,12.631,0.10153,-0.10746,-133.7,-0.0089208,1121.9,3.1033,71.152,0.063366,-37.297,-38.309,-11.046,-9.5866,-232.47,0.26496,-5.8369,0.34776,
0.11002,-1.2771,0.03981,0.64617,0.30059,0.1234,0.44545,-0.24674,-0.77867,20.118,4.0719,10.209,-0.26283,0.78482,0.045945,-0.052282,4.2106,-2.0805,-1.6222,-0.61852,0.35008,-0.20797,
6.3877,-0.03457,-4.8618,0.0046028,1.9289,2.0246,0.45742,0.41286,-6.4763,0.22573,-12.484,0.045575,46.597,0.039694,-2.9435,-2.9878,-8.6993,-9.2502,-28.021,0.044924,4.8194,-0.01319,
-0.61611,-0.93429,-0.024992,-0.41975,-0.16123,0.14947,0.13649,-0.14157,-0.021949,11.75,-0.052733,2.4176,-0.095771,5.6156,-3.4378,3.8407,-8.1114,9.7898,0.21838,-1.5927,0.062828,3.2782,
-31.438,-0.17315,-1.1616,0.51986,-1.4378,-0.67413,-0.88653,1.4797,4.3061,-14.303,-36.427,-1.1961,-5.1635,-3.3778,15.957,-1.9017,38.597,-12.985,20.774,-0.18251,1.0324,-0.20916,
-32.974,0.019983,-1.2536,-0.57776,-0.56838,-1.4867,1.5069,-0.90556,4.4818,14.508,-38.1,0.46842,-5.2303,3.3982,-1.9722,16.359,-13.295,39.441,21.039,0.13943,1.1369,0.23958,
-10.739,-0.77464,0.096323,0.86174,-2.9548,-0.90714,-6.5966,0.49604,1.2024,-26.098,-16.52,0.53749,-6.0283,-9.7014,39.599,-12.032,180.82,12.768,17.108,-0.10072,-0.03583,-2.4471,
-10.624,0.57573,0.12995,-0.9847,-0.86178,-3.0305,0.36745,-6.6576,1.1787,25.854,-15.037,-0.87112,-6.2269,9.691,-11.77,39.833,13.023,180.16,17.129,0.027023,-0.12148,2.1602,
-5.9014,-0.44647,14.112,-0.47363,-37.932,-40.52,-6.7122,-5.9714,43.8,1.0599,-148.17,-1.4639,-27.495,0.13716,14.728,14.739,12.469,12.622,736.04,-0.67188,-44.599,0.7295,
0.40107,3.462,-0.0037665,-0.18632,0.18529,-0.066053,-0.050853,-0.04553,0.025555,0.84945,-0.12523,-0.49945,0.035014,-1.581,-0.1043,0.1427,-0.088158,0.35414,-0.70646,8.7378,0.023415,-0.91027,
-38.179,-0.10882,-3.2698,0.036274,3.4018,3.5255,0.91538,0.8712,-2.9485,0.015039,-26.829,0.23123,4.1175,0.04921,1.8065,1.9552,0.57491,0.51098,-37.759,0.003806,13.203,0.060298,
-1.0549,3.0558,-0.042959,-0.026692,-1.4013,1.3926,0.24691,-0.12116,-0.039727,2.6753,-0.32385,2.0246,-0.11976,3.6085,-0.42964,0.72508,-0.83255,2.102,0.89547,-0.85411,0.092518,27.21;

Xc4 << 517.28,1.5187,22.284,0.094958,2.6701,2.8467,-6.3504,-6.2785,-62.301,-1.421,577.04,1.3026,36.837,-0.45569,-31.344,-31.79,-16.55,-16.468,-81.525,0.42716,-39.481,-0.092501,
1.6392,4.1613,0.078834,0.41636,0.15841,-0.015422,-0.12544,0.033205,-0.0054057,-0.37464,0.87339,-0.51827,-0.14848,-0.97694,0.21783,-0.45884,0.71931,-0.42386,-0.34118,3.9439,-0.24868,2.0729,
29.919,0.079652,2.7428,-0.0025912,-0.71402,-0.70407,-0.44344,-0.43672,-3.024,-0.066447,38.472,0.105,-0.75513,-0.017383,-1.4635,-1.4789,0.41858,0.45383,11.078,0.0079431,-3.2315,0.0025039,
-0.023359,0.28667,-0.0072211,1.5787,-0.018368,0.09901,-0.10843,0.17994,-0.094973,-3.8182,0.3468,0.84751,-0.0055235,-0.013812,0.40212,-0.39498,0.14647,-0.22514,-0.46864,-0.46026,0.01473,0.32792,
-2.431,0.11391,-0.95687,0.028213,3.816,2.508,0.71482,0.68892,-4.3777,1.0997,5.9213,-0.098277,1.6635,-0.53935,-0.35926,0.0033233,-1.4955,-0.72752,-40.211,0.34599,2.6869,-2.0445,
-2.3495,-0.03868,-0.952,0.059398,2.5169,3.8619,0.73333,0.77781,-4.4946,-1.1515,6.5727,0.42468,1.623,0.5447,-0.016906,-0.35228,-0.64585,-1.4677,-40.501,-0.15837,2.6705,2.2375,
-8.3874,-0.1237,-0.58608,-0.12656,0.76903,0.76938,3.9775,2.5852,-3.7336,3.133,5.0476,0.089847,2.1572,-0.74645,-1.7535,-1.3372,-8.0709,-5.6538,-5.4546,-0.11568,-0.067878,0.1489,
-8.3366,-0.0075912,-0.58385,0.17019,0.72989,0.81443,2.6015,3.9763,-3.7608,-3.4337,4.9727,0.076582,2.1524,0.80186,-1.4442,-1.6882,-5.7695,-7.9475,-5.4341,-0.026758,-0.044566,-0.11139,
-46.621,0.11478,-0.55842,-0.079023,-4.7672,-4.8223,-3.0228,-3.0355,30.813,0.15734,-132.32,-0.88787,-17.446,-0.085489,0.89414,0.73564,-2.2781,-2.2122,60.35,0.023509,-7.2056,-0.2226,
-1.2978,-2.1009,-0.027871,-3.9635,2.0005,-2.1318,3.6502,-4.1063,0.25816,130.25,0.011398,12.517,-0.45682,0.22326,-8.6046,10.377,-1.9803,7.7841,0.47558,1.5625,0.26334,-10.79,
499.76,0.23403,23.417,0.26061,13.288,13.75,13.339,13.217,-159.96,-0.15984,1303.5,5.3085,81.808,0.093989,-24.322,-23.502,6.5813,7.5579,-196.19,0.19338,-7.1257,0.82325,
0.96379,-1.1942,0.07148,0.77804,0.082904,0.34404,0.38702,-0.06291,-1.1125,14.36,5.7929,8.4569,-0.15006,1.0728,-0.59841,0.86936,2.2358,-0.82238,-2.0864,-0.63249,0.42671,0.92518,
9.517,-0.083616,-4.6521,0.00094204,1.5391,1.5087,0.40922,0.3613,-6.3771,0.18667,-10.243,-0.37463,44.816,-0.005175,-3.3332,-3.3214,-9.8376,-10.265,-27.612,0.015208,4.682,-0.037656,
-0.54331,-1.0351,-0.022767,-0.31654,-0.22131,0.19935,0.21252,-0.22323,-0.066431,9.4934,0.066767,1.9295,-0.058673,4.2855,-2.7857,3.2489,-5.2307,7.017,0.0060734,-1.4341,0.11816,3.2952,
-33.426,0.013565,-1.4626,0.53748,-1.2558,-0.43467,-3.0718,-0.85558,1.9973,-15.696,-35.083,-0.88865,-2.4175,-2.9429,24.726,7.9138,73.135,26.524,7.088,-0.20516,4.2047,-0.24742,
-34.029,-0.32833,-1.4971,-0.55738,-0.38832,-1.2758,-0.84271,-3.0706,1.8863,16.431,-34.645,0.83958,-2.3573,3.0528,8.1044,24.933,27.021,73.802,6.9847,0.12233,4.3469,0.16051,
-28.753,-0.65959,-1.606,0.51044,-2.3637,-0.5727,-11.351,-4.3229,-1.0605,-23.506,-22.635,0.74229,-1.4032,-7.9879,72.265,27.685,312.42,152.06,12.628,-0.011222,5.3775,-2.539,
-28.63,0.20438,-1.5655,-0.62623,-0.44176,-2.5091,-4.5059,-11.4,-0.99309,22.83,-20.741,-1.1684,-1.7144,7.8974,28.362,72.294,153.34,312.44,12.37,-0.12769,5.3038,2.0769,
6.7211,-0.10718,15.288,-0.48025,-40.342,-40.625,-6.4151,-6.4578,49.356,0.4298,-88.298,-1.7786,-25.062,-0.02774,0.30794,0.24678,3.0176,3.1808,716.36,-0.51939,-47.403,-0.90006,
0.36508,3.9983,-0.0011363,-0.18628,0.35481,-0.13779,-0.14626,0.026773,-0.0045282,0.70844,-0.072852,-0.41253,0.003492,-1.5035,-0.062271,0.053091,0.19561,0.21361,-0.54409,9.2835,-0.0020341,-0.48448,
-48.743,-0.26096,-3.5734,0.016376,2.153,2.0924,-0.10627,-0.10222,-2.6536,0.085153,-39.347,0.20359,4.9301,0.063044,3.8302,3.8915,2.5476,2.3442,-39.778,-0.049119,16.044,0.059764,
-0.47072,1.7815,-0.031895,-0.074973,-1.8615,2.1308,0.54352,-0.45016,-0.3154,3.305,0.7263,2.5185,-0.16219,3.6281,-0.87093,1.1872,-1.2058,2.8342,-0.86327,-0.47291,0.17672,27.091;

Xc5 << 725.17,2.2668,25.19,0.2667,23.253,22.909,9.2852,9.5931,-111.17,-3.3405,736.5,2.9275,40.643,-0.46303,-24.494,-21.971,-19.816,-20.727,-101.28,0.46564,-54.248,2.2202,
2.6472,4.6522,0.10596,0.48256,0.2809,0.08133,-0.082656,0.13108,-0.090561,-1.7715,0.7146,-0.63617,-0.15176,-1.239,-0.080365,-0.56508,0.050198,-0.17787,-0.14552,4.4125,-0.49359,0.98258,
33.557,0.095483,2.5815,0.0027299,0.19998,0.25541,0.27603,0.26041,-4.167,-0.21342,39.468,0.1873,-0.70068,-0.021701,-1.1622,-1.0337,0.23075,0.20957,13.254,0.011119,-3.7969,-0.00099804,
0.1654,0.28878,-0.0029706,1.465,0.094842,-0.0047825,-0.079434,0.1679,-0.11616,-2.7987,0.33536,0.94105,0.0026659,-0.034826,0.13351,-0.14497,-0.45113,0.2892,-0.5869,-0.44849,0.0034199,0.37075,
18.82,0.17593,-0.054938,0.11881,5.0918,3.6329,1.8719,1.9624,-8.7265,0.11306,23.375,-0.13576,0.7505,-0.40919,-1.2468,-0.78155,-3.99,-2.6429,-47.131,-0.1765,0.35638,-0.99416,
18.893,0.086534,0.012739,-0.025666,3.6578,4.781,1.9018,1.9831,-8.4658,-0.16678,23.301,0.63307,0.67182,0.37028,-1.0418,-1.2481,-2.5853,-4.1261,-43.573,0.47661,-0.018246,1.7973,
6.0337,-0.17303,-0.15314,-0.11537,2.1443,2.1634,10.138,8.7373,-10.991,3.0806,24.477,-0.092841,4.6645,-0.62185,-4.8688,-4.7359,-22.927,-20.636,-8.7435,-0.024062,-1.5381,0.055901,
6.2057,0.097038,-0.1797,0.18042,2.2671,2.1962,8.7652,10.202,-11.177,-3.368,24.359,0.4792,4.7684,0.62781,-4.8974,-4.754,-20.916,-23.151,-10.169,-0.21119,-1.3825,-0.14094,
-89.733,0.1184,-1.415,-0.10903,-8.013,-7.6009,-8.505,-8.6722,46.385,0.10108,-172.52,-1.2022,-16.995,-0.047555,-7.7125,-8.0814,-7.746,-7.7103,82.844,0.022209,-9.2549,-0.55119,
-3.9131,-2.8306,-0.11039,-2.7752,0.63454,-0.83754,3.2262,-3.5549,0.16693,104.21,0.14047,5.4211,-0.6456,0.28549,-4.5039,7.1014,8.0595,0.534,-1.2485,0.74674,0.6842,-7.9927,
625.54,-0.31113,23.277,0.27202,21.889,21.303,32.117,32.3,-191.09,-1.4826,1513.6,8.1179,82.46,0.11593,16.246,19.183,32.671,32.977,-192.76,0.19116,-0.39915,1.909,
2.5542,-1.2573,0.15173,0.88594,-0.0098342,0.54147,0.50448,0.2418,-1.7194,8.8845,9.3119,8.4822,-0.36926,1.8247,-1.2639,2.5855,0.1057,3.1006,-3.1454,-0.64005,0.54405,2.2116,
9.2339,-0.10394,-4.6613,0.0056399,0.76028,0.62371,1.9096,1.9219,-5.3596,0.16301,-21.321,-1.1405,45.613,0.050201,-5.1028,-5.0525,-25.648,-26.155,-27.25,-0.03086,4.2319,-0.010365,
-0.64457,-1.212,-0.02938,-0.3294,-0.19086,0.14103,0.18032,-0.22232,-0.063379,8.6456,0.091135,1.801,0.027745,3.279,-1.664,2.1036,-3.0829,5.0764,-0.11393,-1.2088,0.18143,2.409,
-39.235,0.024512,-2.3604,0.27928,-3.06,-2.4737,-7.4921,-5.9784,-4.2185,-10.94,-17.674,-1.6032,1.7852,-2.137,55.135,42.217,171.21,136.57,-14.696,-0.12223,12.082,0.1719,
-37.163,-0.74828,-2.2341,-0.30417,-2.2445,-3.0122,-5.8791,-7.3446,-4.6338,12.207,-11.655,1.9119,1.4652,2.2975,42.313,53.994,136.42,172.66,-15.061,0.044682,11.815,-0.45021,
-64.864,-0.41973,-3.93,0.29744,-6.0368,-4.5145,-28.21,-21.295,-4.0947,-17.251,-15.525,-1.1059,-9.9878,-6.5148,169.35,136.27,763.97,604.41,1.6763,0.073342,15.586,-3.7888,
-66.031,-0.76556,-3.9176,-0.43209,-4.3923,-6.2771,-21.449,-28.257,-4.0264,15.977,-13.102,0.9998,-10.529,6.1107,137.91,169.17,605.76,768.78,1.4728,-0.29268,15.677,2.9049,
16.853,0.20405,17.553,-0.55553,-43.903,-40.357,-7.1501,-8.626,64.595,-1.6796,-63.342,-2.5196,-23.487,-0.15361,-20.914,-20.793,-12.751,-12.684,917.24,-0.44906,-77.314,-6.1034,
0.35772,4.5537,0.0018222,-0.21519,-0.14242,0.47798,0.013927,-0.12185,-0.046753,0.32107,0.11884,-0.44443,0.0053909,-1.4164,0.0071104,-0.041246,0.7471,-0.034985,-0.48031,9.8139,-0.017758,0.42686,
-71.282,-0.48428,-4.293,-0.0056663,-0.84861,-1.2308,-2.2099,-2.1285,-2.3472,0.36677,-41.365,0.074838,4.8804,0.059982,9.5174,9.1574,8.4379,8.7046,-67.081,-0.040374,27.863,0.13725,
1.3567,0.60941,-0.046663,0.1337,-0.96019,1.7823,0.4914,-0.37192,-0.72305,3.6256,2.1413,3.272,-0.081556,2.794,-0.43901,0.68306,-1.8606,4.0882,-6.3506,0.40582,0.37737,21.577;

Xc6 << 913.22,1.1574,27.906,0.25073,36.574,36.254,-37.357,-37.422,-195.19,1.3942,918.98,4.1701,46.276,0.043408,4.5342,5.5491,-7.2306,-8.6493,-119.7,0.21432,7.3455,4.8111,
1.6433,5.8883,0.06541,0.49591,0.26437,-0.059194,-0.22997,0.096124,-0.22149,-3.2184,-0.82017,-1.9331,-0.11417,-1.7153,-0.26295,-0.445,0.32193,0.062214,0.78019,4.9148,-0.21583,0.17586,
36.986,0.048793,2.522,0.0020218,0.99769,0.99169,-1.3589,-1.3845,-8.005,0.022811,43.474,0.23953,-0.42833,-0.012675,-0.17684,-0.15646,2.1022,2.0185,14.398,0.0075155,-3.314,0.11628,
0.28542,0.31983,0.0044499,1.4162,0.14075,-0.058423,-0.022826,0.02197,-0.063651,-1.1284,0.11456,1.124,-0.011891,-0.089797,-0.26908,0.085564,-0.57813,0.49193,-0.36825,-0.46483,0.026559,0.70438,
36.046,0.065691,0.99058,0.10084,6.2465,5.1164,-0.81227,-0.73729,-10.818,-0.33763,39.225,0.40985,-2.1373,-0.11841,-2.9261,-2.3397,-1.7448,-0.56729,-32.57,-0.31358,1.9575,0.55509,
35.898,-0.054029,0.99116,-0.10421,5.1315,6.2556,-0.71462,-0.7651,-10.706,0.88478,38.46,0.37291,-2.1074,0.20035,-2.6238,-2.9459,-0.46499,-1.8685,-31.748,0.37347,1.5818,0.13608,
-40.401,-0.32911,-1.3853,-0.055681,-0.24543,-0.089234,12.873,11.891,6.0558,0.41804,-25.325,-0.52816,2.1077,-0.21621,-7.5551,-7.4717,-32.509,-30.117,5.2955,-0.021769,-1.8757,-0.15389,
-40.485,0.18564,-1.4129,0.048563,-0.099045,-0.25744,11.943,12.998,6.0137,-0.66936,-25.888,-0.20282,2.255,0.14062,-7.5772,-7.6191,-30.452,-32.642,4.5634,-0.080058,-1.5942,-0.22679,
-190.89,-0.017164,-5.9898,-0.027755,-9.6714,-9.4969,7.5193,7.5155,52.048,-0.36411,-232.39,-1.0317,-8.2275,-0.031205,-6.8142,-7.0429,-4.5186,-4.1062,43.314,-0.083742,-7.579,-0.87623,
-0.12349,-2.806,-0.027786,-1.071,-0.56963,0.56255,0.75158,0.16283,-0.083305,40.283,6.9118,-7.028,0.38046,1.5048,4.7481,-3.1814,12.875,-11.735,-4.9005,-0.15207,0.97993,-3.158,
793.18,-1.4696,26.939,0.072045,21.564,20.864,-10.018,-10.112,-200.17,7.0733,1824.7,6.9998,92.416,-0.1908,50.02,49.095,-66.542,-67.49,-200.51,0.094183,39.686,1.6161,
4.7031,-2.227,0.32531,1.1362,0.11681,0.32429,0.19269,-0.27717,-1.2794,-2.6355,12.372,15.236,-1.2671,1.836,-3.5446,2.5768,-4.4519,9.2432,-2.492,-0.49559,0.38213,3.682,
8.8192,-0.037652,-4.6713,0.018163,-0.90186,-0.89771,0.59137,0.6448,0.62656,-0.45753,-24.902,-1.7143,45.053,0.048327,2.7667,2.7653,-13.809,-13.842,-27.958,-0.053149,6.0221,-0.096551,
0.041884,-1.5906,0.010389,-0.25718,-0.038482,0.077585,0.10137,-0.12891,-0.072256,5.3052,0.78896,0.28996,-0.11085,1.6134,0.15711,-0.34704,1.1553,-0.34466,-0.28408,-1.0868,0.090872,0.5957,
-14.296,-0.17071,-1.7671,-0.18618,-5.71,-5.1389,-8.6411,-8.134,-1.4558,2.071,8.6821,-4.5593,9.7783,-0.41585,68.797,62.633,212.6,196.49,-34.659,0.15385,12.006,-0.59008,
-13.235,-0.49945,-1.6691,0.067514,-4.9888,-5.6532,-8.195,-8.6235,-1.9124,-1.5118,11.929,2.8215,9.0756,0.48097,63.09,69.674,196.18,215.05,-34.682,-0.14621,11.939,-0.51477,
-20.533,0.58223,-0.015647,-0.21243,-3.1802,-1.7315,-37.849,-33.767,-5.0324,3.4274,-66.107,-6.848,-10.246,-1.6792,208.29,191.75,1147.5,1059.4,38.34,0.093659,-5.8891,-2.6882,
-21.93,-0.67572,-0.0095476,0.21435,-1.7873,-3.2171,-33.49,-37.969,-4.9357,-6.9659,-64.34,7.2794,-10.864,0.13982,192.55,208.87,1058.8,1154.6,38.704,-0.49299,-5.8879,1.3244,
23.874,0.93839,18.982,-0.30261,-27.31,-26.531,-0.42485,-1.2017,12.118,-4.8713,-38.714,-1.4551,-23.901,-0.18555,-35.655,-35.461,30.064,30.601,1091.9,-0.1806,-213.25,-3.9879,
0.021013,4.9,0.00057497,-0.2343,-0.32587,0.32685,0.063772,0.025558,-0.028918,-0.076846,0.32826,-0.18714,0.053365,-1.2205,0.16287,-0.10817,0.7956,0.017141,-0.17937,10.341,0.060236,2.3437,
-24.446,-0.206,-4.4312,0.019662,0.56421,0.15767,-0.07701,0.13507,0.67486,0.64739,-3.1303,-0.1206,6.3672,-0.04782,10.196,9.9886,-5.5928,-5.6425,-210.53,0.055292,55.875,0.72732,
4.6459,-0.2501,0.11556,0.63822,0.56056,0.16315,-0.0055006,-0.19436,-1.0012,0.28548,4.0511,3.6364,-0.20339,0.81131,-0.056969,-0.43173,-0.66314,1.6029,-4.6587,2.1782,0.88135,11.736;

Xc7 << 1118.5,0.67716,27.85,0.6928,-17.704,-14.202,-51.658,-52.67,-211.21,2.0953,1066.4,5.4246,54.83,0.42179,-11.994,-14.927,14.39,12.868,-146.79,0.68519,9.8772,4.6744,
1.6895,5.3288,0.090403,0.32459,-0.32616,-0.14436,-0.028099,0.18128,0.12982,-0.79744,-2.478,-1.3113,-0.028492,-1.2888,-0.109,0.31459,-0.57385,0.69812,2.7379,5.1201,-0.76391,-0.070756,
40.099,0.066545,2.5074,0.010272,-1.0663,-0.98564,-1.663,-1.7072,-7.4518,0.087959,41.418,0.40463,-0.88722,-0.0039566,0.2633,0.031808,4.3132,4.2892,17.069,0.0038367,-3.4654,0.12614,
0.6767,0.15105,0.0061366,1.2686,0.016628,0.012906,0.069816,-0.065022,-0.10958,-0.61016,0.11131,1.1297,0.020087,-0.045374,-0.24678,0.17646,-0.35779,0.21316,-0.87585,-0.39322,-0.027297,0.080036,
-20.798,-0.34777,-0.89815,-0.012134,4.1298,2.9652,2.2407,2.344,2.3605,-0.58239,-18.285,-0.28914,-0.42899,-0.092019,-4.0351,-2.8426,-7.4363,-6.9497,-21.06,-0.22245,0.47458,-0.4358,
-17.604,-0.11581,-0.85107,0.015044,2.9938,4.0304,2.1938,2.236,1.8294,0.86688,-14.537,0.24945,-0.2808,0.16993,-3.1236,-3.8127,-6.5331,-7.1965,-24.814,0.21294,0.94867,-0.10348,
-51.901,0.037745,-1.1838,0.069506,2.2409,2.1226,7.6869,6.8128,10.987,-0.9527,-42.606,-0.078105,-0.38897,-0.16756,-4.4716,-3.7065,-20.708,-18.414,8.0206,-0.1151,-2,0.067787,
-52.985,0.24431,-1.2274,-0.030774,2.3176,2.1756,6.8389,7.8162,11.146,0.74031,-44.075,-0.53734,-0.31854,0.013737,-4.1315,-4.1463,-18.734,-20.575,7.9133,0.034204,-1.9816,-0.23568,
-209.65,0.37251,-5.1599,-0.088113,2.2161,1.6648,11.127,11.271,49.144,-0.42673,-214.07,-1.061,-8.5613,-0.18901,1.4456,2.0062,-2.2541,-2.1393,44.419,-0.057429,-7.1332,-0.52245,
0.82754,-0.83416,0.061092,-0.65755,-0.42993,0.76276,-0.26462,0.80959,-0.1571,25.927,12.477,-1.1917,0.042297,1.0387,2.0628,-3.4991,3.9713,-0.41183,-5.1375,0.19432,0.77132,-1.6617,
952.75,-2.6589,23.816,0.077803,-13.222,-9.9069,-32.6,-33.3,-191.15,10.292,1955,13.636,104.18,-0.31823,-79.874,-76.751,-62.839,-64.011,-233.5,-0.24077,39.644,1.0635,
6.5071,-1.5578,0.52025,1.1085,-0.17886,0.10955,0.33765,-0.49897,-1.4332,0.40037,24.065,10.626,-1.7748,0.65103,0.31469,0.87103,4.5112,2.1077,-2.4297,-0.66655,0.077106,1.1545,
14.806,-0.097928,-4.0608,0.022352,0.51268,0.48811,-1.5791,-1.5823,-1.8172,-0.53443,10.442,-2.1444,32.84,0.020011,1.8862,3.0082,-4.2615,-4.3085,-31.386,0.018059,5.7719,-0.13306,
0.18559,-1.2055,0.0098444,-0.15394,-0.062321,0.11715,-0.014803,-0.022879,-0.15518,3.3686,1.0528,0.45159,-0.15729,1.1879,0.41195,-0.73586,1.291,-0.25259,-0.72345,-1.072,0.20064,0.50644,
2.5462,0.024932,0.91743,-0.22844,-5.4389,-4.3373,-6.3992,-6.1208,-6.0086,2.3721,-53.527,-0.18191,-6.036,0.41047,124.22,118.16,200.43,197.39,18.039,0.26204,-0.80406,0.68719,
-2.2258,0.16996,0.5848,0.20503,-3.954,-5.2128,-5.741,-6.1626,-5.0448,-4.1039,-56.638,0.75413,-4.7517,-0.45369,118.08,122.35,192.57,199.96,15.564,-0.31053,-0.2817,-0.21091,
37.059,-0.70444,3.7392,-0.26587,-7.2634,-7.1731,-25.831,-22.824,-11.991,1.8702,-20.783,1.0245,-8.9642,0.57934,183.58,177.39,729.99,690.13,38.802,0.1102,-7.9481,-0.31948,
36.538,-0.22482,3.8099,0.18099,-7.0969,-7.4732,-22.67,-25.864,-12.037,-3.9732,-19.763,-0.24505,-9.4838,-0.97675,180.09,183.7,688.97,729.01,40.161,-0.35114,-8.117,-0.50145,
25.088,2.872,22.001,-0.79016,-23.981,-27.258,-0.017651,-0.32678,11.443,-4.6526,-39.306,-0.97591,-26.284,-0.73483,15.922,13.024,40.041,41.49,1313.3,-0.56346,-220.82,-2.9515,
0.64715,5.1495,0.016252,-0.1746,-0.23773,0.28074,-0.079853,0.12176,-0.070378,0.080816,0.47155,-0.40346,-0.046096,-1.1831,0.27531,-0.22183,0.85972,0.41916,-0.68511,10.348,0.056086,1.1981,
-22.402,-0.61323,-4.3939,-0.018814,0.73432,1.0735,-0.1705,-0.1425,0.52451,0.47671,-3.5844,-0.46678,5.7837,0.068162,-3.0634,-2.3353,-8.5958,-8.5452,-218.62,0.036392,59.109,0.20635,
4.8933,-0.17553,0.13354,0.055466,-0.42294,-0.0029203,0.076592,-0.21184,-0.69385,-0.3289,3.7392,1.2802,-0.17407,0.45291,0.67824,-0.5387,1.0959,0.1624,-3.5578,1.1942,0.32182,4.96;

Yc1 << -1016.4,9.1348,-7.6735,0.96993,-142.57,-140.85,106.45,105.16,357.37,7.6295,-441.24,6.7407,75.485,5.9221,49.503,44.867,-75.391,-55.83,-281.11,-1.4945,404.84,21.381,
-1026.4,-9.2294,-7.7264,-0.13865,-139.71,-142.03,104.15,105.61,362.01,-8.8046,-443.29,-5.2683,76.786,-5.722,57.767,39.322,-59.926,-75.068,-231.22,1.9182,394.6,-17.543,
-910.07,6.3367,-0.15328,1.0119,-170.56,-172.53,130.06,127.95,500.94,4.8602,-564.06,3.4009,-137.58,5.6352,-175.21,-175.75,120.52,148.38,-396.01,-0.63913,370.32,13.574,
-916.75,-6.3961,-0.16947,-0.42761,-169.63,-173.03,126.83,130.52,505.19,-5.7079,-565.64,-3.935,-138.19,-5.6582,-167.44,-185.05,144.9,123.83,-366.69,1.1619,364.07,-12.136,
1.1438,-0.01456,-0.15433,0.034194,0.21967,0.27102,-0.66393,-0.40899,-2.4542,-0.47502,2.2472,-0.10702,1.1573,0.011274,2.5938,1.942,0.62793,-1.3546,-0.35271,-0.037549,0.71676,-0.0057289,
1.4153,0.018871,-0.14303,-0.03109,0.30271,0.24897,-0.42411,-0.67656,-2.4769,0.49871,2.0904,0.10656,1.1429,-0.0097593,1.9079,2.5885,-1.3908,0.60965,0.14255,0.032134,0.52339,-0.011103,
-4.7581,0.084621,-0.27029,0.43071,-7.5677,-6.034,-0.066283,3.468,11.559,-0.21664,-2.2421,0.31896,-0.76594,4.7305,-2.5218,1.6311,-37.07,-23.789,-4.4056,-0.6308,6.7973,1.7052,
-3.7664,-0.075579,-0.2833,-0.4279,-6.1037,-7.8784,3.4888,0.088561,11.113,0.23336,-1.1224,-0.63071,-0.80723,-4.5537,1.7722,-2.2503,-25.053,-36.688,-12.828,0.56436,8.3601,-1.623,
0.78758,-0.00096837,0.0099615,0.00059792,0.2264,0.22068,-0.10831,-0.10835,-0.48116,-0.025679,0.62951,-0.0018814,0.27151,0.013048,0.15873,0.17509,-0.27482,-0.24016,-0.011686,-0.011556,-0.35146,-0.022014,
0.13929,-0.063015,0.0023185,0.0044633,0.019985,-0.0029672,-0.029449,0.048963,-0.054949,0.083251,0.37564,0.053079,-0.10195,-0.069993,-0.058635,-0.18719,0.40569,-0.089723,-1.5485,0.011975,0.19851,-0.21137,
0.1552,-0.0023318,-0.0053373,0.0023372,-0.0011203,-0.05822,0.026595,0.036276,-0.19369,-0.066357,0.72223,-0.0083911,-0.11177,0.03251,-0.12574,-0.08993,0.097676,0.23022,-3.4523,-0.031332,0.6323,-0.070188;

Yc2 << -647.46,4.7973,15.278,-1.623,28.834,28.708,33.781,35.651,-9.8683,16.702,-34.547,5.7545,134.48,-3.1359,23.032,12.893,-7.1161,-35.896,-497.76,2.4217,122.61,11.673,
-658.73,-8.1332,14.616,3.5617,29.731,27.45,34.896,34.531,-5.8604,-10.115,-52.572,-1.3033,134.47,6.969,16.276,20.49,-35.716,-11.695,-474.87,-2.8694,120,-7.3141,
-692.19,6.5324,-7.4464,-1.1703,10.969,7.4389,41.534,33.053,184.02,5.4404,-1119.2,-1.3237,-274.46,7.0774,19.673,31.65,91.184,140.17,-304.71,2.3078,76.296,10.114,
-698.83,-7.5662,-7.7795,1.2137,8.4802,9.5434,32.325,41.87,186.34,-5.093,-1127.5,-0.96703,-273.82,-5.095,35.005,16.714,137.47,89.729,-288.16,-2.1082,74.187,-9.4986,
0.22306,-0.019793,-0.078257,0.038066,-0.083837,-0.025453,-0.14307,0.087229,0.15788,-0.75799,-0.81889,-0.070804,-0.70939,-0.054479,0.35025,-0.29757,1.1865,-0.80761,1.6423,-0.018491,-0.24155,-0.0039889,
0.30786,0.025106,-0.073923,-0.04429,-0.03384,-0.082097,0.083978,-0.15531,0.15198,0.74321,-0.82688,0.03369,-0.70363,0.041866,-0.29666,0.36469,-0.813,1.2423,1.7156,0.020742,-0.2516,-0.0063719,
5.7999,0.015631,0.13404,0.45186,-1.4236,0.049677,-1.5828,1.5803,2.406,-6.2946,-9.7268,-0.25631,-4.7601,2.8742,-2.7587,0.13933,-25.362,-13.894,14.218,-0.28398,-2.3615,1.7797,
6.2412,0.033693,0.11559,-0.46724,0.0056989,-1.3689,1.6149,-1.6126,2.3105,6.1436,-9.967,-0.30654,-4.5925,-2.8704,0.077862,-2.4808,-14.738,-24.25,12.693,0.22374,-2.232,-1.6524,
-0.17061,-0.0028206,0.055165,0.00076266,0.026409,0.022089,0.02002,0.012814,-0.11603,-0.043746,0.54314,-0.0090492,0.32646,0.012453,-0.0054437,0.014047,-0.085828,-0.011456,-0.25885,-0.0097358,0.058914,-0.0068814,
0.072172,-0.044193,0.0018707,0.02785,0.0056475,0.017865,-0.036456,0.039672,-0.066097,-0.032481,0.48792,0.025853,0.046841,-0.10028,0.088729,-0.094658,0.46575,-0.13219,-0.68635,0.010996,0.037758,-0.12793,
0.15521,-0.0006999,-0.0050668,-0.00069104,0.036782,0.01369,0.022242,-0.0019465,-0.15451,-0.12347,0.98723,-0.031514,0.050464,0.0376,-0.056049,0.0067487,0.039105,0.27689,-2.0753,-0.020796,0.17271,-0.03582;

Yc3 << -340.06,2.5545,39.974,-2.8006,36.212,39.916,18.085,24.246,-66.651,34.435,232.04,9.3087,142.77,-12.76,26.08,2.3349,82.88,-9.2692,-373.08,3.3548,64.987,4.0501,
-353.29,-4.9375,39.005,3.9027,38.65,37.741,25.004,18.311,-65.996,-24.691,225.07,-2.5602,144.83,15.96,1.9483,27.981,-9.2941,78.223,-367.83,-3.0918,64.842,0.55332,
-777.58,7.061,-7.2093,-2.0176,10.918,7.305,13.353,0.55573,197.02,6.7874,-1596.9,-4.7356,-320.46,5.2092,71.401,89.432,58.587,110.13,-79.478,2.8526,40.232,7.5162,
-788.1,-8.3566,-7.8172,1.7777,6.0831,10.456,-0.066334,13.726,199.67,-12.595,-1605.6,-3.1112,-322.35,-3.9407,88.319,73.991,109.24,55.855,-62.617,-3.3232,39.16,-6.501,
-1.2376,-0.011605,-0.15573,0.040452,-0.10787,-0.061719,-0.12425,0.0983,0.4373,-0.92069,-2.9814,-0.055805,-1.0223,-0.035467,0.48526,-0.13529,0.97405,-0.95436,1.3377,-0.015439,-0.056107,0.0054235,
-1.2852,0.010794,-0.16041,-0.044191,-0.053817,-0.1097,0.095593,-0.12709,0.44651,0.91542,-3.0824,0.027624,-1.0176,0.03083,-0.12929,0.50091,-0.92056,1.0301,1.2866,0.016173,-0.048987,-0.012703,
-1.5297,-0.0057684,0.059053,0.37684,-2.1508,-0.80535,-1.2534,1.7807,4.837,-7.4415,-25.787,-0.22589,-7.933,2.4142,-5.0434,-2.1665,-42.071,-30.248,22.363,-0.33305,-1.9568,2.0204,
-1.3501,0.035714,0.055724,-0.39696,-0.77082,-2.2745,1.7,-1.313,4.9823,7.582,-26.767,-0.15942,-7.63,-2.3308,-2.2568,-4.9042,-30.035,-40.837,22.911,0.26774,-2.03,-1.8618,
-0.077258,-0.0024675,0.066686,0.00010297,0.030507,0.028795,0.020132,0.013878,-0.10014,-0.037021,0.48774,-0.0069432,0.21269,0.0092495,-0.0089059,0.00722,0.047392,0.10906,-0.31826,-0.0061603,0.039107,-0.0074711,
0.039495,-0.036114,-0.00038885,0.020225,0.012673,0.02783,-0.026949,0.037032,-0.043033,0.10927,0.28964,0.04728,0.069131,-0.098031,0.10694,-0.079264,0.5334,-0.10702,-0.38514,0.0090803,0.0062545,-0.1029,
0.12428,-0.0029437,-0.008695,0.0013765,0.085611,0.077989,0.024739,-0.0050362,-0.12646,-0.17749,0.72508,-0.040099,0.11734,0.044411,-0.040052,0.042423,0.17641,0.49672,-1.5993,-0.022244,0.075674,-0.036001;

Yc4 << -39.22,0.87603,56.512,-2.3914,21.117,24.179,16.432,26.643,-88.798,37.291,488.35,6.8595,153.82,-20.241,32.513,-3.3326,149.15,5.0217,-334.7,3.6424,41.943,-6.0114,
-49.052,-2.8368,55.702,3.4233,23.765,21.656,27.222,16.918,-89.635,-33.742,480.98,-0.53267,157.71,22.055,-4.8496,33.359,-0.49022,143.13,-331.81,-3.7135,42.826,9.9715,
-963.85,6.4566,-10.862,-2.5382,-0.61807,-6.1451,-11.673,-25.361,241.41,15.223,-1931.7,-5.5086,-339.46,-1.2709,66.767,67.746,43.073,53.575,3.9715,3.2844,39.933,-1.7252,
-973.63,-7.905,-11.31,2.129,-6.7489,-1.5728,-26.923,-11.31,243.19,-19.384,-1937.6,-3.9852,-338.87,2.424,69.195,65.426,50.276,38.022,15.731,-3.9651,40.1,2.8073,
-2.0041,0.0058602,-0.19031,0.039897,-0.066129,-0.024168,-0.22751,-0.036261,0.501,-1.0356,-4.0311,-0.023954,-1.0296,-0.034937,0.44071,-0.11024,0.76843,-0.88402,0.62268,-0.012259,0.10193,0.011895,
-2.0132,-0.0096288,-0.19242,-0.04155,-0.021971,-0.068701,-0.040028,-0.23221,0.49988,1.0713,-4.0653,0.01422,-1.0157,0.036056,-0.081051,0.47037,-0.7814,0.89245,0.60821,0.014158,0.10687,-0.018028,
-18.516,-0.047827,-0.40792,0.32945,-2.2568,-0.83163,-0.21792,2.3067,10.198,-9.4415,-62.865,-0.31806,-10.707,1.8848,-18.604,-15.702,-98.227,-82.154,26.027,-0.42484,-2.3965,2.3784,
-18.57,0.099015,-0.44834,-0.36537,-0.87971,-2.2916,2.1277,-0.45731,10.494,9.567,-64.528,-0.20618,-10.222,-1.7779,-15.129,-17.817,-79.353,-94.535,26.021,0.34792,-2.4427,-2.3226,
-0.051189,-0.0022152,0.070554,-0.00013941,0.019097,0.017212,0.01965,0.016157,-0.073725,-0.020691,0.32535,-0.0030593,0.15718,0.0049895,0.025314,0.034403,0.1306,0.1693,-0.26231,-0.004222,0.036907,-0.0066404,
0.076327,-0.030403,-0.0002726,0.022572,0.0073815,0.025601,-0.027054,0.043703,-0.054711,0.10506,0.27734,0.033958,0.086841,-0.082356,0.13863,-0.017927,0.64722,0.040675,-0.25889,0.0056943,0.0053288,-0.067182,
0.13837,-0.0030844,-0.0019754,-7.4489e-06,0.081537,0.070269,0.032874,0.011165,-0.16873,-0.18644,0.71124,-0.027714,0.19089,0.047432,0.075702,0.1593,0.48071,0.85326,-1.2761,-0.023227,0.068217,-0.026145;

Yc5 << 329.61,0.33655,67.305,-1.0965,25.075,28.671,37.806,52.934,-144.43,-1.0116,849.06,-2.948,199.99,-20.624,28.1,-3.7391,84.309,-67.349,-375.92,2.0697,16.983,-6.7372,
310.19,-1.5452,67.127,2.0838,28.542,22.421,49.914,36.093,-138.95,-1.6461,824.18,7.0554,198.29,21.377,-7.3605,27.831,-75.437,74.246,-359.44,-1.7311,18.005,9.6626,
-1303.3,5.0341,-26.333,-2.351,-27.983,-30.599,-47.607,-55.965,298.89,-0.83371,-2301.6,-10.289,-375.57,-6.8099,35.718,17.082,94.978,55.172,139.98,2.2894,37.635,-8.2088,
-1318,-6.7465,-27.381,1.4663,-32.312,-28.735,-59.729,-50.955,302.18,7.5933,-2305.4,-0.62442,-375.08,7.342,22.889,31.218,46.674,92.316,143.82,-3.5067,40.482,5.8993,
-3.6479,0.011888,-0.25332,0.024237,-0.13805,-0.11905,-0.52773,-0.40193,0.66637,-0.76852,-4.9716,-0.032941,-1.0478,-0.031848,0.62791,0.25531,1.4358,0.28286,-0.1872,-0.013905,0.457,0.043078,
-3.4673,-0.030591,-0.25243,-0.027166,-0.11025,-0.13469,-0.38864,-0.51512,0.64517,0.86584,-5.0244,0.042576,-0.97738,0.040379,0.2276,0.57013,0.21817,1.3926,-0.16852,0.019022,0.43638,-0.046608,
-50.529,0.15696,-1.122,0.29859,-2.2544,-0.9722,1.6751,3.5602,22.702,-12.087,-149.26,-0.63419,-11.397,1.016,-58.589,-55.633,-274.21,-248.64,34.58,-0.30689,-4.6243,2.0971,
-51.446,0.11896,-1.2287,-0.34526,-1.1797,-2.1674,3.2708,1.2072,23.179,12.746,-152.32,-0.87502,-10.597,-0.78125,-54.399,-57.54,-242.62,-269.25,33.581,0.19533,-4.5166,-2.3906,
-0.043099,-0.0019712,0.072581,-9.6043e-05,0.0093743,0.0073888,0.021968,0.021731,-0.051791,-0.010687,0.20275,-0.0029489,0.14916,0.0022041,0.033933,0.035357,0.07833,0.086668,-0.21944,-0.0024645,0.035112,-0.0049228,
0.17236,-0.026465,0.0037957,0.033112,0.00047065,0.033124,-0.02715,0.068693,-0.097401,-0.14718,0.49604,0.012679,0.12395,-0.053773,0.18699,0.088651,0.84654,0.42086,-0.26174,-0.010232,0.01481,0.011325,
0.26476,-0.0065485,0.0042697,-0.010216,0.070706,0.054624,0.049354,0.037838,-0.22815,-0.030852,0.97587,-0.00060605,0.24529,0.042418,0.26215,0.33897,1.1994,1.527,-1.1943,-0.016844,0.09251,-0.022663;

Yc6 << 756.62,0.90105,72.689,-1.3262,30.006,38.433,-0.90599,20.038,-193.62,4.7885,1513.9,-20.63,274.03,-19.875,91.866,72.643,144.34,51.391,-222.12,1.4973,14.238,-9.3996,
706.66,-3.8116,74.016,0.91542,36.913,27.646,19.299,-2.6175,-182.2,1.5671,1409.5,18.384,254,20.421,61.635,81.946,31.328,129.42,-168.29,-1.1309,3.2138,11.697,
-1439.5,11.769,-43.62,-1.267,-37.399,-35.372,15.989,23.124,309.21,-48.183,-2589.2,-5.7564,-410.72,-14.01,-87.024,-85.627,51.6,36.904,419.34,0.79054,-84.851,-15.086,
-1436,-7.8423,-45.951,1.4105,-38.052,-38.003,21.24,14.646,311.14,26.998,-2580.3,3.6733,-412.49,11.633,-91.413,-91.178,-4.2025,8.7553,413.76,0.06557,-81.244,6.4285,
-4.1654,0.006588,-0.27715,0.0019591,-0.2332,-0.23722,-0.46404,-0.44126,0.82329,-0.11873,-8.3128,-0.063222,-1.0283,0.0015998,0.30027,0.19853,0.91128,0.46315,-0.9565,-0.004245,0.40557,0.016013,
-4.045,-0.019741,-0.27291,-0.0063365,-0.23364,-0.23014,-0.44376,-0.46511,0.79018,0.089017,-7.8908,0.085895,-1.0339,0.0063916,0.24874,0.35545,0.61896,1.0768,-1.0308,0.0069646,0.41265,-0.05102,
-155.66,0.23864,-3.6548,0.24098,-4.3702,-4.0155,8.179,8.4401,40.452,-10.07,-331.48,3.2252,-32.461,-0.061915,-85.285,-79.641,-402.46,-378.33,52.915,-0.19373,-10.792,0.8468,
-156.95,0.32829,-3.7007,-0.28374,-4.2802,-4.3833,8.4783,8.2286,40.817,8.2711,-331.83,-5.0075,-31.527,0.76574,-79.012,-84.305,-377.04,-403.94,52.337,0.25215,-10.548,-1.3455,
0.47679,-0.0012306,0.093913,-0.00024451,0.011989,0.011468,0.020551,0.019993,-0.115,-0.0055376,0.95742,-0.0040737,0.20164,0.00010439,0.085217,0.087035,0.23796,0.24365,0.17017,-0.0027101,-0.046244,-0.0026298,
0.26977,-0.034225,0.011397,0.028332,-0.0058173,0.029163,-0.045415,0.038186,-0.068315,-0.017243,0.66792,0.0055892,0.1446,-0.037017,0.1461,0.1056,0.64727,0.43909,-0.2693,-0.010773,0.047286,0.046867,
0.38471,-0.01691,0.012635,-0.02842,0.024575,0.021591,0.0088297,-0.018741,-0.10081,0.15792,1.2379,-0.058287,0.29383,0.023101,0.37325,0.352,1.7144,1.6859,-0.75059,-0.016116,0.13781,-0.07593;

Yc7 << 974.22,-4.4921,58.433,-0.51595,0.47983,6.8339,-39.841,-40.115,-197.26,9.5888,1963.7,-2.7129,315.11,-8.3266,-12.709,-2.7701,153.53,150.21,-385.47,-0.48251,29.368,-1.6425,
931.51,-3.1542,59.433,1.0975,4.1478,3.2596,-40.669,-41.784,-194.66,1.5063,1889,3.7101,306.19,9.0588,-7.062,3.7002,154.5,156.4,-333.47,0.73133,15.532,1.8144,
-1336.7,3.691,-51.249,-1.4856,19.618,18.485,50.608,54.365,217.86,-13.851,-2419.4,-5.4071,-363.84,-9.9989,49.98,41.011,-108.19,-106.26,260.5,-1.0766,-74.146,-5.3167,
-1297.5,1.6808,-51.036,1.6324,18.497,12.67,49.601,48.751,213.84,-1.5858,-2396.6,3.5267,-366.88,8.8506,51.312,37.426,-110.8,-109.36,280.43,1.0533,-69.755,2.4341,
-5.4746,0.015437,-0.062595,-0.0091977,-0.15485,-0.1424,-0.0037843,0.017921,0.62179,0.026766,-12.789,0.017227,-2.4825,0.03191,0.73184,0.51096,0.059662,-0.09958,2.5377,0.010318,-0.30767,0.031657,
-5.6378,0.018156,-0.085889,0.0050215,-0.10675,-0.15624,0.034881,0.014411,0.66829,-0.14272,-13.016,0.0059618,-2.3573,-0.018027,0.54137,0.55186,-0.23637,-0.039234,2.2798,-0.010149,-0.25112,-0.013169,
-232.36,0.75706,-4.0205,0.14153,3.3033,2.4794,11.123,10.77,45.498,-7.1762,-458.82,0.017219,-39.451,0.19311,-49.131,-48.318,-249.26,-239.46,70,-0.055082,-11.639,0.55137,
-234.39,0.80704,-4.1659,-0.19041,3.2736,2.6087,10.594,11.266,45.896,3.1109,-462.92,-4.5913,-37.779,0.17721,-47.868,-51.017,-238.65,-248.1,69.6,0.2957,-11.524,-0.77174,
1.5201,-0.0020054,0.088938,-0.00038984,-0.028205,-0.02567,-0.0661,-0.067319,-0.27401,0.0029773,2.5305,0.002297,0.34854,-0.00070581,-0.0057734,0.0030979,0.20471,0.20289,0.39283,-0.00078708,-0.078734,0.00011819,
0.17008,-0.068043,0.0035508,0.034125,-0.011677,0.025409,-0.039705,0.025787,-0.033647,0.024575,0.65483,-0.0033303,0.12054,-0.020637,0.068235,0.058672,0.51038,0.45836,-0.34164,-0.039935,0.045199,0.02468,
-0.058972,-0.0012724,-0.0087871,-0.024205,0.023798,0.019855,0.03199,-0.0099804,0.011752,0.10145,0.7203,-0.002609,0.12275,0.056713,0.16638,0.14322,1.082,1.0667,-0.71002,-0.003756,0.086484,-0.0056376;
	}
//*************************************************************************//

	virtual ~Vant5RamcVaryinglyapunov(){}

//************************************************************************//
Eigen::VectorXd ForwardVelocitytoAlpha(double Ub)
{

	Eigen::MatrixXd x0(18,49);
	Eigen::MatrixXd u0(11,49);
	Eigen::VectorXd Ueq(11);
	Eigen::VectorXd out(15);

	x0 << -1.5801e-14,-3.0901e-18,1.8493e-17,-1.1395e-15,1.0193e-15,-1.3961e-23,-1.7073e-15,-5.815e-16,4.6559e-16,-1.34e-14,-7.4282e-18,-7.3369e-25,-2.6091e-16,-1.2102e-23,6.8758e-25,4.8554e-25,3.0684e-25,-3.9678e-17,-1.2608e-24,2.1628e-16,-1.0032e-15,-3.6896e-22,-7.7142e-24,8.6291e-16,-5.6789e-15,-4.2188e-17,1.0873e-23,-1.7533e-16,-6.9399e-14,8.2338e-20,1.3697e-14,-1.6178e-23,-6.4518e-16,-1.1693e-15,-1.995e-22,3.0871e-19,8.4412e-20,-5.1233e-18,2.8298e-17,1.2057e-15,-1.3178e-20,1.5409e-21,1.1567e-17,-8.9822e-21,3.2837e-15,1.5803e-17,-1.8977e-19,-1.3378e-18,2.8633e-19,
8.3785e-14,-3.0901e-18,1.1931e-16,1.6568e-14,-5.4901e-15,-1.3923e-23,-5.4629e-15,-5.815e-16,-1.9523e-15,-3.8349e-14,7.4277e-18,7.3369e-25,1.5612e-14,-1.2102e-23,-6.8758e-25,4.8554e-25,-3.0684e-25,-3.9678e-17,1.2608e-24,2.1628e-16,-1.0008e-15,3.6896e-22,7.7142e-24,8.6291e-16,6.8369e-15,4.2187e-17,-1.0871e-23,1.7499e-16,6.9401e-14,-8.2338e-20,-1.3695e-14,1.6178e-23,6.4518e-16,1.1646e-15,-1.9794e-22,-3.087e-19,-8.4179e-20,5.1233e-18,2.8298e-17,1.2057e-15,1.3178e-20,-1.5409e-21,-1.1567e-17,-8.9698e-21,-3.2837e-15,1.5803e-17,1.8977e-19,1.3378e-18,2.8633e-19,
8.0407e-14,3.0901e-18,-1.1931e-16,-1.6568e-14,5.4901e-15,1.3961e-23,5.4629e-15,-5.815e-16,1.9523e-15,3.8349e-14,-7.4282e-18,-5.799e-25,-1.5612e-14,-1.2102e-23,4.4753e-25,-4.2315e-25,2.3414e-25,-3.9678e-17,-1.2608e-24,-2.1628e-16,-1.0032e-15,3.6896e-22,-7.7142e-24,-8.6291e-16,-6.8369e-15,-4.2188e-17,1.0877e-23,-1.7533e-16,-6.9401e-14,8.2338e-20,-1.3697e-14,1.6178e-23,-6.4518e-16,-1.1693e-15,1.995e-22,3.0872e-19,8.444e-20,-5.1233e-18,2.8298e-17,-1.2057e-15,1.3178e-20,1.5409e-21,1.1567e-17,8.9822e-21,-3.2837e-15,1.5803e-17,1.8977e-19,1.3378e-18,5.0646e-20,
7.7751e-14,3.0901e-18,-1.1931e-16,-1.6568e-14,-5.4901e-15,-1.391e-23,5.4629e-15,5.815e-16,-1.9523e-15,-3.8349e-14,-7.4279e-18,-7.3369e-25,-1.5612e-14,1.1936e-23,-6.8758e-25,4.8554e-25,-3.0684e-25,3.9678e-17,-1.2608e-24,2.1628e-16,-1.0032e-15,-3.6896e-22,-7.7142e-24,8.6291e-16,6.8369e-15,4.2187e-17,1.0875e-23,1.7531e-16,-6.9401e-14,8.2338e-20,1.3697e-14,-1.6178e-23,6.4518e-16,1.1657e-15,1.995e-22,3.0871e-19,8.0202e-20,-5.1233e-18,-8.0371e-18,-1.2057e-15,-1.3169e-20,1.5409e-21,-1.1567e-17,-8.9822e-21,-3.2837e-15,1.5803e-17,1.8976e-19,-1.3378e-18,-2.8633e-19,
8.3785e-14,1.9727e-07,3.1563e-06,1.5979e-05,5.0501e-05,0.00012329,0.00025566,0.00047365,0.00080802,0.0012943,0.0019727,0.0028882,0.0040906,0.0056343,0.0075784,0.0099869,0.012928,0.016476,0.020709,0.025709,0.031563,0.038365,0.046212,0.055205,0.06545,0.077059,0.090148,0.10484,0.12125,0.13953,0.15979,0.18218,0.20685,0.23395,0.26362,0.29603,0.33134,0.36972,0.41134,0.45638,0.50501,0.55744,0.61385,0.67443,0.73939,0.80894,0.88327,0.96262,1.0472,
8.1565e-14,1.9727e-07,3.1563e-06,1.5979e-05,5.0501e-05,0.00012329,0.00025566,0.00047365,0.00080802,0.0012943,0.0019727,0.0028882,0.0040906,0.0056343,0.0075784,0.0099869,0.012928,0.016476,0.020709,0.025709,0.031563,0.038365,0.046212,0.055205,0.06545,0.077059,0.090148,0.10484,0.12125,0.13953,0.15979,0.18218,0.20685,0.23395,0.26362,0.29603,0.33134,0.36972,0.41134,0.45638,0.50501,0.55744,0.61385,0.67443,0.73939,0.80894,0.88327,0.96262,1.0472,
1.293e-11,0.00019283,0.0007712,0.0017348,0.003083,0.0048153,0.0069308,0.009429,0.012309,0.015571,0.019215,0.023242,0.027655,0.032457,0.037653,0.043251,0.049263,0.055703,0.062592,0.069954,0.077822,0.086239,0.095257,0.10494,0.11538,0.12666,0.13893,0.15232,0.16704,0.18332,0.20144,0.22177,0.24475,0.27091,0.30095,0.33569,0.37671,0.42324,0.47904,0.54484,0.62243,0.71403,0.81931,0.93924,1.0716,1.2121,1.3552,1.4941,1.6265,
1.1622e-11,0.00019283,0.0007712,0.0017348,0.003083,0.0048153,0.0069308,0.009429,0.012309,0.015571,0.019215,0.023242,0.027655,0.032457,0.037653,0.043251,0.049263,0.055703,0.062591,0.069953,0.077822,0.086239,0.095257,0.10494,0.11538,0.12666,0.13892,0.15232,0.16704,0.18331,0.20143,0.22176,0.24473,0.27089,0.3009,0.33557,0.37538,0.42353,0.47923,0.54503,0.62272,0.71332,0.81927,0.93927,1.0716,1.2123,1.3554,1.4946,1.6207,
5.0691e-14,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,
-8.3785e-14,-3.09e-18,1.1931e-16,1.6568e-14,-5.4901e-15,2.8619e-24,-5.4629e-15,-5.3406e-16,-1.9523e-15,-3.8349e-14,7.4282e-18,7.337e-25,1.5612e-14,-1.2102e-23,-6.8758e-25,4.8554e-25,-3.0684e-25,-3.9678e-17,1.2608e-24,-2.1628e-16,-1.0007e-15,-3.6896e-22,7.7142e-24,8.6291e-16,6.8369e-15,4.2188e-17,-1.0811e-23,1.7533e-16,-6.7512e-14,-8.2339e-20,-1.3637e-14,1.6178e-23,6.4518e-16,1.1693e-15,1.995e-22,-3.0872e-19,-8.444e-20,-5.1233e-18,2.8298e-17,1.2053e-15,1.3167e-20,-1.5414e-21,1.1565e-17,8.9822e-21,-3.2837e-15,-1.5803e-17,1.8956e-19,1.2889e-18,2.8633e-19,
-8.3785e-14,-3.0901e-18,1.1931e-16,1.6568e-14,-5.4901e-15,-1.3961e-23,-5.4629e-15,5.815e-16,-1.9523e-15,-3.8349e-14,7.4282e-18,7.3369e-25,1.5612e-14,1.2102e-23,6.8758e-25,-4.8554e-25,-3.0684e-25,3.9678e-17,1.2608e-24,2.1628e-16,1.0032e-15,-3.6896e-22,7.7142e-24,8.6291e-16,6.8369e-15,4.2188e-17,-1.0877e-23,1.7533e-16,6.9401e-14,-8.2338e-20,1.3697e-14,-1.6178e-23,6.4518e-16,1.1693e-15,-1.995e-22,-3.0872e-19,-8.444e-20,5.1233e-18,-2.8298e-17,1.2057e-15,-1.3178e-20,-1.5409e-21,-1.1567e-17,-8.9822e-21,3.2837e-15,-1.5803e-17,-1.8977e-19,-1.3378e-18,2.8635e-19,
-8.966e-23,-3.3643e-23,2.8467e-22,-9.0728e-21,8.0818e-22,6.1687e-26,-2.6723e-21,2.2602e-23,-2.1825e-21,8.7862e-21,2.3148e-25,7.3369e-25,5.1093e-23,3.8788e-25,-5.1972e-25,4.8554e-25,2.5696e-25,4.3361e-25,5.1646e-25,1.1019e-25,1.4403e-23,-1.6073e-27,1.0481e-24,-4.2557e-22,-7.6971e-23,-9.6969e-25,7.3872e-26,4.9021e-23,3.3896e-28,1.6281e-27,-4.0331e-24,-2.2986e-25,-5.4957e-27,-1.7996e-26,2.8318e-27,1.1005e-25,-1.0114e-23,1.3925e-23,-3.7335e-26,7.5374e-24,6.7172e-25,-5.3747e-24,-1.8206e-24,-2.8915e-26,-1.8185e-22,6.4658e-27,2.336e-25,6.1177e-23,-9.1242e-22,
2.338e-21,2.485e-23,-7.2309e-22,-9.0839e-21,2.1894e-21,2.6361e-25,-1.1997e-21,-8.2246e-22,-1.041e-21,-4.2948e-21,2.2138e-24,-6.6315e-25,1.6198e-20,-1.1292e-24,-2.863e-25,-2.4522e-26,3.3797e-26,-2.8864e-25,1.5222e-25,-2.2985e-24,2.1072e-23,7.0443e-27,-1.2973e-25,-3.0249e-22,2.7998e-21,6.4365e-24,-5.9062e-26,9.0026e-23,4.8911e-22,2.8395e-26,-5.0246e-22,1.4186e-25,-1.4987e-23,-1.2661e-21,6.7697e-26,-1.2815e-26,-4.5754e-23,3.5881e-23,-4.6926e-25,1.4503e-21,6.7292e-25,-5.6685e-24,-2.9591e-24,-1.6283e-25,7.0811e-21,-6.3795e-26,7.4815e-25,2.2657e-22,-9.6684e-22,
-3.6123e-21,-1.0942e-23,2.7488e-22,-4.5038e-21,2.6852e-21,1.4117e-25,1.2967e-21,-2.1354e-23,-2.2797e-21,7.8325e-21,-2.8471e-23,2.1059e-25,1.1131e-21,6.1664e-25,6.8758e-25,2.8372e-25,3.0684e-25,-1.375e-22,1.9145e-25,2.6208e-22,-7.3422e-22,-1.5881e-26,1.2101e-25,-7.9323e-22,-3.3254e-22,2.4576e-22,2.4839e-25,-3.3044e-22,2.8205e-22,-7.6309e-26,-1.4175e-21,-4.5544e-25,2.4564e-21,1.571e-21,-7.7119e-27,-3.9939e-25,-2.3439e-23,8.6468e-23,-1.4372e-25,6.0416e-21,1.8623e-24,-2.682e-24,2.4627e-22,-2.0782e-25,5.0155e-22,-1.9281e-26,-9.5665e-25,-1.3064e-22,-1.5524e-22,
1.1279e-26,-1.9778e-24,8.3165e-23,1.3671e-21,6.6706e-22,-1.9674e-26,-1.293e-22,-7.0213e-22,6.7985e-22,4.0886e-21,5.582e-26,4.7537e-26,-1.3637e-26,-1.188e-25,4.0817e-26,-1.1147e-26,1.1603e-26,1.3129e-27,1.2014e-26,-7.2062e-28,-4.9584e-27,4.7892e-30,-9.7713e-27,-4.7239e-24,1.8577e-28,-2.3991e-26,8.7311e-28,-1.2545e-24,1.7189e-26,-2.4708e-26,-3.2159e-22,4.1788e-26,-4.5635e-27,7.1543e-27,-3.8392e-26,-1.378e-25,-1.6648e-23,-8.2872e-24,-7.0222e-26,-5.219e-24,1.1429e-24,2.2256e-23,-1.4844e-23,-3.512e-26,4.6458e-27,6.7554e-26,2.6333e-25,-2.6684e-22,-8.6816e-23,
4.3481e-26,-1.4537e-23,1.6242e-22,1.8783e-21,8.8458e-22,-3.3348e-26,2.1512e-22,1.6929e-22,1.8542e-22,2.9369e-21,1.7365e-26,-2.4078e-26,6.5092e-27,2.9089e-25,1.3598e-25,-5.854e-28,-2.7148e-27,5.3205e-27,-2.7009e-27,7.9219e-28,-4.4801e-27,7.3698e-29,3.6276e-27,7.1233e-24,-6.4884e-28,-1.4776e-26,1.5062e-28,7.474e-25,-1.4891e-28,1.6963e-28,-7.7132e-24,-4.1122e-27,1.4531e-28,6.1016e-29,9.9732e-28,8.6894e-28,-1.7333e-25,3.8331e-23,-6.4034e-26,1.1229e-24,-3.0336e-25,1.1498e-24,2.7598e-25,-1.7921e-27,3.8415e-26,3.8565e-27,9.7484e-26,5.9517e-25,6.0781e-23,
2.6856e-26,2.4332e-23,4.8115e-22,5.268e-21,3.2337e-21,-4.6007e-26,-1.3496e-22,1.6647e-22,6.7312e-22,6.2509e-22,8.0803e-26,-1.2756e-25,1.1586e-26,1.2575e-24,-1.0506e-25,-2.0327e-26,3.417e-27,-2.6423e-27,1.5685e-26,-1.1145e-26,2.2241e-26,2.1287e-27,-6.4467e-27,7.6085e-23,5.4495e-28,1.1807e-25,6.1756e-28,5.759e-24,-2.6996e-27,4.0391e-28,3.0996e-22,-1.9418e-26,-1.5105e-27,2.2736e-27,-5.0147e-27,-9.4236e-26,2.6115e-23,6.6328e-23,-1.4571e-25,4.3916e-25,1.9385e-26,1.6359e-24,-8.2592e-25,4.7123e-26,2.0145e-26,-8.1397e-28,5.1641e-26,7.6158e-23,6.7387e-23,
6.6391e-28,-1.3827e-23,-5.0727e-24,4.5328e-21,-1.5789e-21,-1.3675e-25,-4.4955e-22,-2.0692e-22,5.0694e-22,5.5073e-22,3.6177e-26,-5.5633e-26,3.4127e-27,5.9316e-25,-2.3499e-26,2.6176e-26,1.7405e-26,2.9863e-26,1.2223e-26,2.2013e-26,1.6578e-26,1.6866e-27,2.7599e-26,1.6698e-24,4.5507e-28,-1.0747e-25,-4.6751e-28,1.3791e-23,5.4064e-28,-4.1917e-27,4.0266e-23,3.4415e-26,-8.3923e-27,-3.3169e-27,1.5754e-26,-9.1633e-27,8.2673e-25,-1.7996e-23,1.8227e-25,4.8305e-24,1.5218e-24,1.3679e-23,-4.5137e-24,-1.8819e-25,1.9399e-26,-1.1834e-26,6.5349e-26,1.9553e-23,6.6255e-23;

u0 << 36.304,36.29,36.248,36.179,36.082,35.957,35.803,35.622,35.412,35.173,34.906,34.609,34.283,33.928,33.543,33.128,32.682,32.207,31.701,31.165,30.599,30.003,29.378,28.723,28.041,27.33,26.594,25.832,25.046,24.237,23.407,22.557,21.689,20.804,19.901,18.977,17.882,17.164,16.192,15.219,14.25,12.955,12.089,11.04,9.9685,8.8945,7.8274,6.7571,5.8984,
36.304,36.29,36.248,36.179,36.082,35.957,35.803,35.622,35.412,35.173,34.906,34.609,34.283,33.928,33.543,33.128,32.682,32.207,31.701,31.165,30.599,30.003,29.378,28.723,28.041,27.331,26.594,25.833,25.047,24.239,23.409,22.561,21.694,20.812,19.916,19.012,18.25,17.082,16.136,15.155,14.129,13.382,12.16,11.08,9.9988,8.9218,7.8576,6.806,5.4886,
73.954,73.921,73.821,73.654,73.42,73.121,72.755,72.324,71.827,71.265,70.639,69.949,69.196,68.38,67.502,66.562,65.561,64.499,63.378,62.198,60.96,59.664,58.311,56.903,55.44,53.924,52.356,50.738,49.073,47.363,45.612,43.826,42.012,40.178,38.338,36.51,34.821,32.92,31.28,29.777,28.466,27.656,26.89,26.677,26.954,27.725,28.971,30.679,32.675,
73.954,73.921,73.821,73.654,73.42,73.121,72.755,72.324,71.827,71.265,70.639,69.949,69.196,68.38,67.502,66.562,65.561,64.499,63.378,62.198,60.96,59.664,58.311,56.903,55.44,53.923,52.355,50.736,49.07,47.36,45.608,43.821,42.004,40.167,38.321,36.478,34.556,32.961,31.299,29.794,28.515,27.304,26.776,26.568,26.832,27.586,28.814,30.496,32.828,
-0.056837,-0.056815,-0.05675,-0.056641,-0.056488,-0.05629,-0.056047,-0.055758,-0.055421,-0.055036,-0.054602,-0.054116,-0.053578,-0.052985,-0.052337,-0.05163,-0.050864,-0.050037,-0.049146,-0.04819,-0.047167,-0.046074,-0.044912,-0.043677,-0.042369,-0.040986,-0.039527,-0.037992,-0.03638,-0.034689,-0.032921,-0.031074,-0.029149,-0.027143,-0.025057,-0.022882,-0.02038,-0.018413,-0.01599,-0.01351,-0.010983,-0.0078986,-0.0054416,-0.0026653,0.00016797,0.0030133,0.0058372,0.0086336,0.011039,
-0.056837,-0.056815,-0.05675,-0.056641,-0.056488,-0.05629,-0.056047,-0.055758,-0.055421,-0.055036,-0.054602,-0.054116,-0.053578,-0.052985,-0.052337,-0.05163,-0.050864,-0.050037,-0.049146,-0.04819,-0.047167,-0.046075,-0.044912,-0.043677,-0.042369,-0.040987,-0.039528,-0.037993,-0.036381,-0.034692,-0.032924,-0.031079,-0.029156,-0.027156,-0.02508,-0.022935,-0.020957,-0.018284,-0.015901,-0.013409,-0.010793,-0.0085661,-0.0055528,-0.0027281,0.0001206,0.0029704,0.0057899,0.0085569,0.011681,
-1.0039,-1.0032,-1.001,-0.9975,-0.99254,-0.98617,-0.9784,-0.96923,-0.95867,-0.94672,-0.9334,-0.91871,-0.90266,-0.88525,-0.86649,-0.84637,-0.8249,-0.80207,-0.77787,-0.75228,-0.72528,-0.69684,-0.66692,-0.63546,-0.60239,-0.56762,-0.53105,-0.49254,-0.45191,-0.40896,-0.36342,-0.31496,-0.26319,-0.20761,-0.1476,-0.082442,-0.012338,0.067918,0.15479,0.25132,0.35833,0.47226,0.59768,0.72242,0.8374,0.92915,0.98486,0.99709,0.96841,
-1.0039,-1.0032,-1.001,-0.9975,-0.99254,-0.98617,-0.9784,-0.96923,-0.95867,-0.94672,-0.9334,-0.91871,-0.90266,-0.88525,-0.86649,-0.84637,-0.82491,-0.80208,-0.77788,-0.75229,-0.7253,-0.69687,-0.66695,-0.6355,-0.60244,-0.5677,-0.53115,-0.49266,-0.45206,-0.40915,-0.36367,-0.31529,-0.26361,-0.20813,-0.14825,-0.083181,-0.010884,0.065563,0.15204,0.24773,0.35318,0.47106,0.59141,0.71389,0.82663,0.91623,0.97015,0.98121,0.94798,
-7.9357e-14,-7.936e-14,-7.9479e-14,-6.2911e-14,-5.7421e-14,-5.7421e-14,-5.1958e-14,-5.254e-14,-5.0589e-14,-1.224e-14,-1.2247e-14,-1.2247e-14,-2.786e-14,-2.786e-14,-2.786e-14,-2.786e-14,-2.786e-14,-2.7899e-14,-2.7899e-14,-2.8116e-14,-2.9117e-14,-2.9117e-14,-2.9117e-14,-2.8254e-14,-2.1417e-14,-2.1459e-14,-2.1459e-14,-2.1635e-14,4.7767e-14,4.7767e-14,3.4073e-14,3.4073e-14,3.3428e-14,3.226e-14,3.226e-14,3.226e-14,3.226e-14,3.2255e-14,3.2227e-14,3.1021e-14,3.1021e-14,3.1021e-14,3.1009e-14,3.1009e-14,2.7726e-14,2.7741e-14,2.7741e-14,2.774e-14,2.774e-14,
8.2463e-14,8.246e-14,8.258e-14,9.9147e-14,9.3657e-14,9.3657e-14,8.8194e-14,8.7625e-14,8.5673e-14,4.7324e-14,4.7331e-14,4.7331e-14,3.1719e-14,3.1719e-14,3.1719e-14,3.1719e-14,3.1719e-14,3.1679e-14,3.1679e-14,3.1463e-14,3.0462e-14,3.0462e-14,3.0462e-14,3.1325e-14,3.8162e-14,3.8204e-14,3.8204e-14,3.8379e-14,-3.1023e-14,-3.1023e-14,-4.4713e-14,-4.4713e-14,-4.5358e-14,-4.4193e-14,-4.4193e-14,-4.4193e-14,-4.4193e-14,-4.4188e-14,-4.4216e-14,-4.301e-14,-4.301e-14,-4.301e-14,-4.2999e-14,-4.2999e-14,-4.6282e-14,-4.6267e-14,-4.6267e-14,-4.6266e-14,-4.6265e-14,
8.377e-14,8.3767e-14,8.3887e-14,6.7319e-14,7.2809e-14,7.2809e-14,6.7346e-14,6.7882e-14,6.9834e-14,1.0818e-13,1.0818e-13,1.0818e-13,9.2563e-14,9.2563e-14,9.2563e-14,9.2563e-14,9.2563e-14,9.2603e-14,9.2603e-14,9.2387e-14,9.3388e-14,9.3388e-14,9.3388e-14,9.2525e-14,8.5704e-14,8.5662e-14,8.5662e-14,8.5487e-14,1.5489e-13,1.5489e-13,1.6849e-13,1.6849e-13,1.6785e-13,1.6668e-13,1.6668e-13,1.6668e-13,1.6668e-13,1.6667e-13,1.6665e-13,1.6544e-13,1.6544e-13,1.6544e-13,1.6543e-13,1.6543e-13,1.6871e-13,1.6873e-13,1.6873e-13,1.6873e-13,1.6873e-13;

	if(Ub >= 47.99)
	{
	   Ub = 47.99;
	}

	double Ubf = floor(Ub);
	double Proportion = Ub - Ubf;

  const auto UbIndex = static_cast<int>(Ubf);

  double AlphafR = (1 - Proportion) * x0(4, UbIndex) + Proportion * x0(4, UbIndex + 1);
  double AlphafL = (1 - Proportion) * x0(5, UbIndex) + Proportion * x0(5, UbIndex + 1);
  double AlphabR = (1 - Proportion) * x0(6, UbIndex) + Proportion * x0(6, UbIndex + 1);
  double AlphabL = (1 - Proportion) * x0(7, UbIndex) + Proportion * x0(7, UbIndex + 1);
  Ueq = (1 - Proportion) * u0.col(UbIndex) + Proportion * u0.col(UbIndex + 1);
  out << AlphafR, AlphafL, AlphabR, AlphabL, Ueq(0), Ueq(1), Ueq(2), Ueq(3), Ueq(4), Ueq(5), Ueq(6), Ueq(7), Ueq(8), Ueq(9), Ueq(10);
	return out;
}
//*************************************************************************************************//
Eigen::VectorXd TrajectoryForwardAccelerationCircularDeceleration(double Tempo)
{
	Eigen::VectorXd Traj(8);
	const double MaxVel = 47.5;
	const double Acceleration = 0.5; //works with 1 as well
	const double TMaxVel = MaxVel/Acceleration;
	const double ZPos = 5;
	const double ZPosF = 5;

	const double TForwardFlight = 30;
	const double TForwardFlight2 = 30;

	const double TCircular = 85;
	const double R = MaxVel*TCircular/(2*pi);

	double x,y,z,psi,xp,yp,zp,psip;

	if(Tempo <= TMaxVel)
	{
		x = (1.0/2.0)*Acceleration*pow(Tempo,2);
		y = 0;
		z = (1.0/2.0)*(2*ZPos/pow(TMaxVel,2))*pow(Tempo,2) + 1;
		psi = 0;

		xp = Acceleration*Tempo;
		yp = 0;
		zp = (2*ZPos/pow(TMaxVel,2))*Tempo;
		psip = 0;
	}
	else if(Tempo > TMaxVel && Tempo <= (TMaxVel + TForwardFlight))
	{
		Traj  = TrajectoryForwardAccelerationCircularDeceleration( TMaxVel );
		Tempo = Tempo - TMaxVel;
		const double x0 = Traj(0);
		const double v0 = Traj(4);

		x =  x0 + v0*Tempo;
		y = 0;
		z = Traj(2);
		psi = 0;

		xp = v0;
		yp = 0;
		zp = 0;
		psip = 0;
	}
	else if(Tempo > (TMaxVel+ TForwardFlight) && Tempo <= (TMaxVel + TForwardFlight + (3.0/4.0)*TCircular))
    	{
		Tempo = Tempo - (TMaxVel+ TForwardFlight);
		Traj = TrajectoryForwardAccelerationCircularDeceleration( TMaxVel + TForwardFlight );

		const double xi = Traj(0);
		const double yi = Traj(1);
		const double zi = Traj(2);

		x = R * cos(2*pi*Tempo/TCircular-pi/2) + xi;
		y = R * sin(2*pi*Tempo/TCircular-pi/2) + R + yi;
		z = zi;
		psi = 2*pi*Tempo/TCircular;

		xp = (2*R*pi*sin(pi/2 - (2*pi*Tempo)/TCircular))/TCircular;
		yp = (2*R*pi*cos(pi/2 - (2*pi*Tempo)/TCircular))/TCircular;
		zp = 0;
		psip = 2*pi/TCircular;
	}
	else if(Tempo > (TMaxVel + TForwardFlight + (3.0/4.0)*TCircular) && Tempo <= (TMaxVel + TForwardFlight + (3.0/4.0)*TCircular + TForwardFlight2))
    	{
		Tempo = Tempo - (TMaxVel + TForwardFlight + (3.0/4.0)*TCircular);
		Traj = TrajectoryForwardAccelerationCircularDeceleration( TMaxVel + TForwardFlight + (3.0/4.0)*TCircular );

		x = Traj(0);
		y = Traj(1) + Traj(5)*Tempo;
		z = Traj(2);
		psi = Traj(3);

		xp = 0;
		yp = Traj(5);
		zp = 0;
		psip = 0;
	}
	else if(Tempo > (TMaxVel + TForwardFlight + (3.0/4.0)*TCircular + TForwardFlight2) && Tempo <= (TMaxVel + TForwardFlight + (3.0/4.0)*TCircular + TForwardFlight2 + TMaxVel ))
	{
    		Tempo = Tempo - (TMaxVel + TForwardFlight + (3.0/4.0)*TCircular + TForwardFlight2);
		Traj = TrajectoryForwardAccelerationCircularDeceleration( TMaxVel + TForwardFlight + (3.0/4.0)*TCircular + TForwardFlight2);

		x = Traj(0);
		y = Traj(1) + Traj(5)*Tempo + (1.0/2.0)*Acceleration*pow(Tempo,2);
		z = Traj(2)-(1.0/2.0)*(2*ZPosF/pow(TMaxVel,2))*(pow(Tempo,2));
		psi = Traj(3);

		xp = 0;
		yp = Traj(5) + Acceleration*Tempo;
		zp = -(2*ZPosF/pow(TMaxVel,2))*Tempo;
		psip = 0;
	}
	else
    	{
		Traj = TrajectoryForwardAccelerationCircularDeceleration( (TMaxVel + TForwardFlight + (3.0/4.0)*TCircular + TForwardFlight2 + TMaxVel ) );

		x = Traj(0);
		y = Traj(1);
		z = Traj(2);
		psi = Traj(3);

		xp = 0;
		yp = 0;
		zp = 0;
		psip = Traj(7);
	}

	Traj << x, y, z, psi, xp, yp, zp, psip;
	return Traj;
}
//*************************************************************************//
Eigen::VectorXd TrajectoryForwardAccelerationCircularDecelerationBody(double Tempo)
{
	Eigen::VectorXd TrajAux(8),xyz(3),phithetapsi(3),dxyz(3),dphithetapsi(3),UVW(3), PQR(3), out(15), qr(10), qpr(10), Traj(31);
	double phi, theta, psi;
	Eigen::MatrixXd RIB(3,3), Wn(3,3);

	TrajAux = TrajectoryForwardAccelerationCircularDeceleration(Tempo);
	xyz << TrajAux(0), TrajAux(1), TrajAux(2);
	phi = 0;
	theta = 0;
	psi = TrajAux(3);
    	dxyz << TrajAux(4), TrajAux(5), TrajAux(6);
	dphithetapsi << 0, 0, TrajAux(7);
    	Wn << 1,                 0,             -sin(theta),
              0,          cos(phi),     sin(phi)*cos(theta),
              0,         -sin(phi),     cos(phi)*cos(theta);
    	RIB <<  (cos(psi)*cos(theta)), (cos(psi)*sin(phi)*sin(theta) - cos(phi)*sin(psi)), (sin(phi)*sin(psi) + 		cos(phi)*cos(psi)*sin(theta)),(cos(theta)*sin(psi)),
	(cos(phi)*cos(psi) + sin(phi)*sin(psi)*sin(theta)), (cos(phi)*sin(psi)*sin(theta) - cos(psi)*sin(phi)),
	(-sin(theta)), (cos(theta)*sin(phi)), (cos(phi)*cos(theta));

    	UVW = RIB.transpose() * dxyz;

    	PQR = Wn * dphithetapsi;

	out = ForwardVelocitytoAlpha( UVW(0) );

	double AlphafR = out(0);
	double AlphafL = out(1);
	double AlphabR = out(2);
	double AlphabL = out(3);

	qr << xyz(0), xyz(1), xyz(2), 0, 0, psi, AlphafR, AlphafL, AlphabR, AlphabL;
	qpr << UVW(0), UVW(1), UVW(2), PQR(0), PQR(1), PQR(2), 0, 0, 0, 0;

	Traj << qr, qpr, out(4), out(5), out(6), out(7), out(8), out(9), out(10), out(11), out(12), out(13), out(14);

	return Traj;
}
//*********************************************************************************//
private: double BumpFunction(double Theta)
{
    double Val;
	if(abs(Theta) < 1.0)
	{
	    Val = exp(-1.0/(1.0-pow(Theta,2)));
	}
	else
	{
	    Val = 0;
	}
	return Val;
}
//***************************************************************************

	void config(){}

//*************************************************************************//	

	std::vector<double> execute(simulator_msgs::SensorArray arraymsg)
	{
		simulator_msgs::Sensor msg;
		static double Tempo = 0;
		static int PrintTime = 0;
		PrintTime = PrintTime + 1;
    		bool found = false;
		for (int i = 0; i < arraymsg.values.size(); i++)
		{
		      if (arraymsg.values.at(i).name == "Estados")
		      {
			      msg = arraymsg.values.at(i);
			      found = true;
			      break;
		      }
		 }

		if (!found)
		 {
		      // In case of error, report the problem in a ROS_LOG, and returns an
      		      // empty array
		      ROS_FATAL("[adaptiveRAMCVaryingLyapVant5Aerod] State vector not found.");
		  	std::vector<double> out(Input.data(), Input.data() + Input.size());
			return out;
		 }



		Trajetoria = TrajectoryForwardAccelerationCircularDecelerationBody(Tempo);
		double phi = msg.values.at(3);
		double theta = msg.values.at(4);
		double psi = msg.values.at(5);

		//Deal's with Psi Discontinuity at 180 degree
		if(psi - Trajetoria(5) < -pi)
		{
		   psi = psi +  2*pi;
		}
		else if(psi - Trajetoria(5) > pi)
		{
		   psi = psi - 2*pi;
		}

		Eigen::VectorXd XpYpZp(3);
		Eigen::VectorXd PhipThetapPsip(3);
		Eigen::VectorXd uvw(3);
		Eigen::VectorXd pqr(3);
		Eigen::MatrixXd RIB(3,3);
		Eigen::MatrixXd Wn(3,3);

		RIB <<  (cos(psi)*cos(theta)), (cos(psi)*sin(phi)*sin(theta) - cos(phi)*sin(psi)), (sin(phi)*sin(psi) + 		cos(phi)*cos(psi)*sin(theta)),(cos(theta)*sin(psi)),
		(cos(phi)*cos(psi) + sin(phi)*sin(psi)*sin(theta)), (cos(phi)*sin(psi)*sin(theta) - cos(psi)*sin(phi)),
		(-sin(theta)), (cos(theta)*sin(phi)), (cos(phi)*cos(theta));



		Wn << 1.0,         0.0,          -sin(theta),
		      0.0,    cos(phi),  cos(theta)*sin(phi),
		      0.0,   -sin(phi),  cos(phi)*cos(theta);

		XpYpZp << msg.values.at(10),
			  msg.values.at(11),
			  msg.values.at(12);


		PhipThetapPsip << msg.values.at(13),
				  msg.values.at(14),
				  msg.values.at(15);


		uvw = RIB.transpose() * XpYpZp;
		pqr = Wn* PhipThetapPsip;
 

	/*****************************kinematic controller****************************/
				/*******************************************************************************/
		//proportional
		Eigen::VectorXd Xk(3);
		Eigen::VectorXd Uk(3);
		Eigen::MatrixXd Kk(3,3);
		Eigen::MatrixXd Kki(3,3);
		Xk << Trajetoria(0) - msg.values.at(0), Trajetoria(1) - msg.values.at(1), 0; // xtr-x, ytr-y
		Uk << Trajetoria(10), Trajetoria(11), Trajetoria(12);
		Kk <<  0.001,    0,   0,
			 0,  0.001,   0,
			 0,    0,   0;
		//integral
		Kki <<  0.0001,    0,   0,
			   0, 0.0001,   0,
		  	   0,    0,    0;
		static double xint, x_ant = 0;
		static double yint, y_ant = 0;
		double x_error = Xk(0);
		xint = xint + (T/2.0)*(x_error + x_ant);
		x_ant = x_error;

		double y_error = Xk(1);
		yint = yint + (T/2.0)*(y_error + y_ant);
		y_ant = y_error;

		Eigen::VectorXd Xki(3);
		Xki << xint, yint, 0;

		//kinematic controller  action
		Eigen::VectorXd Dk(3);
		Dk = Uk + Kk*RIB.transpose()*Xk + Kki*RIB.transpose()*Xki;
		Trajetoria(10) = Dk(0);
		Trajetoria(11) = Dk(1);
		Trajetoria(12) = Dk(2);


		Xref << Trajetoria(2), Trajetoria(3), Trajetoria(4), Trajetoria(5), Trajetoria(6), Trajetoria(7), Trajetoria(8),
			Trajetoria(9), Trajetoria(10), Trajetoria(11), Trajetoria(12), Trajetoria(13), Trajetoria(14),
			Trajetoria(15), Trajetoria(16), Trajetoria(17), Trajetoria(18), Trajetoria(19), 0, 0, 0, 0;
		Uref << Trajetoria(20), Trajetoria(21), Trajetoria(22), Trajetoria(23), Trajetoria(24), Trajetoria(25), Trajetoria(26),
	 		Trajetoria(27), Trajetoria(28), Trajetoria(29), Trajetoria(30);

		//Integrators
		static double zint = 0, z_ant = 0;
		static double yawint = 0, yaw_ant = 0;
		static double uint = 0, u_ant = 0;
		static double vint = 0, v_ant = 0;


		double z_error = msg.values.at(2)-Trajetoria(2);
		zint = zint + (T/2.0)*(z_error + z_ant);
		z_ant = z_error;

		double yaw_error = psi-Trajetoria(5);
		yawint = yawint + (T/2.0)*(yaw_error + yaw_ant);
		yaw_ant = yaw_error;

		double u_error = uvw(0)-Trajetoria(10);
		uint = uint + (T/2.0)*(u_error + u_ant);
		u_ant = u_error;

		double v_error = uvw(1)-Trajetoria(11);
		vint = vint + (T/2.0)*(v_error + v_ant);
		v_ant = v_error;

        intqctil << zint, yawint, uint, vint;

X << msg.values.at(2), //z
		     phi, //phi
		     theta, //theta
		     psi, //psi
		     msg.values.at(6), //a1
		     msg.values.at(7), //a2
		     msg.values.at(8), //a4
		     msg.values.at(9), //a3
		     uvw,
		     pqr,
		     msg.values.at(16), //a1p
		     msg.values.at(17), //a2p
		     msg.values.at(18), //a4p
		     msg.values.at(19),
		     intqctil; //a3p

		XFull << msg.values.at(0), msg.values.at(1),    X; // for plot matlab
		XrefFull << Trajetoria(0),    Trajetoria(1), Xref;

	 	double Ub = Trajetoria(10);

		// Saturation values
		if(Ub < 0.1)
		{
			Ub = 0.1;
		}
		else if(Ub > 47.9){
			Ub = 47.9;
		}

		double Psi[7];
		for (int i=0; i < NSets; i++)
		{
			Psi[i] = BumpFunction((Ub - AdaptiveMixingSetsMean(i)) / AdaptiveMixingSetsCutoff(i));
		}

		double SumPsi = 0;
		for (int i=0; i < NSets; i++)
		{
			SumPsi = SumPsi + Psi[i];
		}

		double B[7];
		for (int i=0; i < NSets; i++)
		{
			B[i] = Psi[i] / SumPsi;
		}

		Yu = B[0]*Yc1 + B[1]*Yc2 + B[2]*Yc3 + B[3]*Yc4 + B[4]*Yc5 + B[5]*Yc6 + B[6]*Yc7;
		Xu = B[0]*Xc1 + B[1]*Xc2 + B[2]*Xc3 + B[3]*Xc4 + B[4]*Xc5 + B[5]*Xc6 + B[6]*Xc7;
                K = Yu*Xu.inverse();

		//Control law
		Erro = (X-Xref);
		Input2 = K*Erro + Uref;

		Input << Input2(0), Input2(1), Input2(2), Input2(3), Input2(4), Input2(5), Input2(6), Input2(7),
		Input2(8), Input2(8), -Input2(9), Input2(9), Input2(10), Input2(10);


		std::vector<double> out(Input.data(), Input.data() + Input.rows() * Input.cols());
		
		
		/*if(PrintTime%50 == 0)
		{
			std::cout << "Deflections Controller: " << Input2(8)  << std::endl << Input2(8)  << std::endl << -Input2(9)  << std::endl << Input2(9)  << std::endl << Input2(10)  << std::endl << Input2(10) << std::endl;
			std::cout << "Erro: " << Erro.transpose() << std::endl;
			std::cout << "Inputs: " << Input.transpose() << std::endl;
			std::cout << "Uref: " << Uref.transpose() << std::endl;
			std::cout << "Xref: " << Xref.transpose() << std::endl;
			std::cout << "Ub: "<< Ub << " Mixing Signals:"<< std::endl << B[0] << std::endl << B[1] << std::endl << B[2] << std::endl << B[3] << std::endl << B[4] << std::endl << B[5] << std::endl << B[6] << std::endl << std::endl;	
		}
		*/
		Tempo = Tempo + T;
		return out;
	}

	std::vector<double> Reference()
	{
		std::vector<double> out(XrefFull.data(), XrefFull.data() + XrefFull.rows() * XrefFull.cols());
		return out;
	}

	std::vector<double> Error()
	{
		std::vector<double> out(Erro.data(), Erro.data() + Erro.rows() * Erro.cols());
		return out;
	}

	std::vector<double> State()
	{
		std::vector<double> out(XFull.data(), XFull.data() + XFull.rows() * XFull.cols());
		return out;
	}
};

extern "C"
{
	Icontroller *create(void) {return new Vant5RamcVaryinglyapunov;}
	void destroy(Icontroller *p) {delete p;}
}
